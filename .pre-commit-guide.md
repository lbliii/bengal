# Pre-commit Hooks Guide

## What Are Pre-commit Hooks?

Pre-commit hooks automatically run checks on your code before each commit, ensuring code quality and consistency. This prevents issues from being committed and maintains the high code standards we've established.

## Installation

Already done! But for reference:

```bash
pip install pre-commit
pre-commit install
```

## What Gets Checked?

### Ruff Linting & Formatting
- **Auto-fixes**: Import sorting, unused imports, exception handling, code simplification
- **Formatting**: Consistent code style (line length, indentation, quotes)
- **Note**: E501 (line-too-long) warnings are shown but won't block commits

### Code Quality Checks
- No debug statements (`print`, `pdb`, etc.)
- No merge conflict markers
- No private keys
- Valid TOML/YAML syntax
- No trailing whitespace
- Proper file endings

## Usage

### Automatic (on every commit)
Pre-commit hooks run automatically when you commit:

```bash
git add .
git commit -m "Your message"
# Hooks run automatically here!
```

If hooks make changes:
- Review the changes
- Stage them: `git add .`
- Commit again

### Manual (run on demand)

Run on all files:
```bash
pre-commit run --all-files
```

Run on specific files:
```bash
pre-commit run --files bengal/cli.py
```

Run only ruff:
```bash
pre-commit run ruff --all-files
```

### Skipping Hooks (use sparingly!)

Only when absolutely necessary:
```bash
git commit --no-verify -m "Emergency fix"
```

## Benefits

✅ **Prevents issues before they're committed**
- Catches linting errors immediately
- Auto-fixes most issues

✅ **Maintains code consistency**
- Everyone uses the same formatting
- Follows Python 3.12 best practices

✅ **Saves review time**
- Automated checks catch issues early
- Fewer back-and-forth on PRs

✅ **Keeps CI/CD green**
- Local checks match CI checks
- Fewer failed builds

## Troubleshooting

### "Hook failed" error
- Review what changed: `git diff`
- The hook auto-fixed issues - stage them: `git add .`
- Commit again

### Slow first run
- First run downloads hook environments (one-time)
- Subsequent runs are fast (~1-2 seconds)

### Update hooks
```bash
pre-commit autoupdate
```

## Configuration

Edit `.pre-commit-config.yaml` to:
- Add/remove hooks
- Change ruff arguments
- Update hook versions

## Current Status

After our cleanup:
- ✅ 12,851 errors fixed (98.7% reduction)
- ✅ All critical issues resolved
- ⚠️ 175 line-length warnings remain (low priority)

Pre-commit ensures we maintain this quality going forward!
