{#-
Module Functions Component

Renders all public functions in the module with comprehensive documentation.
Uses shared components for consistency with method documentation.
-#}

{% from 'macros/safe_macros.md.jinja2' import safe_render, safe_for %}

{% if not public_functions %}
  {% set all_functions = element.children | selectattr('element_type', 'equalto', 'function') | list %}
  {% set public_functions = [] %}
  {% for func in all_functions %}
    {% if not func.name.startswith('_') %}
      {% set _ = public_functions.append(func) %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if public_functions %}
<section class="api-section api-section--functions">
  <h2 class="api-section__title">Functions</h2>
  <div class="api-methods">
    {% call(current_item) safe_for(public_functions, "*No public functions found.*") %}
      {% call safe_render("function", current_item) %}
        <details class="api-card api-card--method">
          <summary class="api-card__header">
            <code class="api-card__name">{{ current_item.name }}</code>
            <div class="api-card__badges">
                {% if current_item.metadata.is_async %}
                  <span class="api-badge--compact api-badge--async">async</span>
                {% endif %}
                <span class="api-badge--compact api-badge--function">function</span>
            </div>
            <span class="api-card__toggle">▸</span>
          </summary>

          <div class="api-card__body">
            {% if current_item.metadata.signature %}
               <div class="api-signature">{{ current_item.metadata.signature }}</div>
            {% endif %}

            <p class="api-card__description">
              {{ current_item.description | default('*No description provided.*') | trim }}
            </p>

            {% if current_item.metadata.aliases %}
            <div class="api-metadata">
                <strong>Aliases:</strong>
                {%- for alias in current_item.metadata.aliases -%}
                <code>{{ alias }}</code>{%- if not loop.last -%}, {% endif -%}
                {%- endfor -%}
            </div>
            {% endif %}

            {% if current_item.metadata.parsed_doc.deprecated %}
            <div class="api-warning">
               <strong>Deprecated:</strong> {{ current_item.metadata.parsed_doc.deprecated }}
            </div>
            {% endif %}

            {% if current_item.metadata.is_async %}
            <div class="api-info">
               <strong>Async Function:</strong> This is an asynchronous function. Use <code>await</code> when calling.
            </div>
            {% endif %}

            {# Parameters #}
            {% if current_item.metadata.args %}
            <div class="api-parameters">
              <h5 class="api-label">Parameters</h5>
              <table class="api-table api-table--compact">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Default</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  {% for arg in current_item.metadata.args %}
                  <tr>
                    <td><code>{{ arg.name }}</code></td>
                    <td>{% if arg.type %}<code>{{ arg.type }}</code>{% else %}—{% endif %}</td>
                    <td>{% if arg.default %}<code>{{ arg.default }}</code>{% else %}—{% endif %}</td>
                    <td>{{ arg.description | default('') | trim }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endif %}

            {# Returns #}
            {% if current_item.metadata.returns %}
            <div class="api-returns">
              <span class="api-returns__label">Returns</span>
              <div class="api-returns__desc">
                  <span class="api-returns__type">{{ current_item.metadata.returns }}</span>
                  {% if current_item.metadata.parsed_doc.returns %} - {{ current_item.metadata.parsed_doc.returns }}{% endif %}
              </div>
            </div>
            {% endif %}

            {# Includes #}
            {% with item = current_item %}
              {% include 'python/partials/method_raises.md.jinja2' %}
              {% include 'python/partials/method_examples.md.jinja2' %}
              {% include 'python/partials/method_notes.md.jinja2' %}
            {% endwith %}

            {% if current_item.metadata.parsed_doc.see_also %}
            <div class="api-see-also">
              <strong>See Also:</strong>
              {%- for ref in current_item.metadata.parsed_doc.see_also -%}
              {{- ref -}}{%- if not loop.last -%}, {% endif -%}
              {%- endfor -%}
            </div>
            {% endif %}
          </div>
        </details>
      {% endcall %}
    {% endcall %}
  </div>
</section>
{% endif %}
