{#-
Module Classes Component

Renders all public classes in the module with safe error boundaries.
Includes class descriptions, inheritance, and nested components.
-#}

{% from 'macros/safe_macros.md.jinja2' import safe_section, safe_render, safe_for, section_shell, subsection_shell %}

{% if not public_classes %}
  {% set all_classes = element.children | selectattr('element_type', 'equalto', 'class') | list %}
  {% set public_classes = [] %}
  {% for cls in all_classes %}
    {% if not cls.name.startswith('_') %}
      {% set _ = public_classes.append(cls) %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if public_classes %}
<section class="api-section api-section--classes">
  <h2 class="api-section__title">Classes</h2>

  <div class="api-cards">
    {% call(current_item) safe_for(public_classes, "*No public classes found.*") %}
      {% call safe_render("class", current_item) %}
        <details class="api-card api-card--class" open>
          <summary class="api-card__header">
            <span class="api-card__icon">◆</span>
            <code class="api-card__name">{{ current_item.name }}</code>
            <span class="api-card__badges">
              {% if current_item.metadata.is_dataclass %}
              <span class="api-badge--compact api-badge--dataclass">dataclass</span>
              {% endif %}
            </span>
            <span class="api-card__toggle">▸</span>
          </summary>

          <div class="api-card__body">
            <p class="api-card__description">
              {% if current_item.description %}
              {{ current_item.description | trim }}
              {% else %}
              *No class description provided.*
              {% endif %}
            </p>

            {% if current_item.metadata.aliases %}
            <div class="api-metadata">
                <strong>Aliases:</strong>
                {%- for alias in current_item.metadata.aliases -%}
                <code>{{ alias }}</code>{%- if not loop.last -%}, {% endif -%}
                {%- endfor -%}
            </div>
            {% endif %}

            {% if current_item.metadata.bases %}
            <div class="api-metadata">
                <strong>Inherits from:</strong>
                {%- for base in current_item.metadata.bases -%}
                <code>{{ base }}</code>{%- if not loop.last -%}, {% endif -%}
                {%- endfor -%}
            </div>
            {% endif %}

            {% with item = current_item %}
              {% include 'python/partials/class_attributes.md.jinja2' %}
              {% include 'python/partials/class_properties.md.jinja2' %}
              {% include 'python/partials/class_methods.md.jinja2' %}
            {% endwith %}
          </div>
        </details>
      {% endcall %}
    {% endcall %}
  </div>
</section>
{% endif %}
