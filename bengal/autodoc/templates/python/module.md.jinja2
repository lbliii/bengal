{% extends "base/base.md.jinja2" %}

{% from 'macros/safe_macros.md.jinja2' import safe_section %}

{% block doc_type %}python-module{% endblock %}

{% block header %}{% endblock %}
{% block badges %}{% endblock %}

{% block content %}
{#- Pre-calculate stats for the header -#}
{% set all_classes = element.children | selectattr('element_type', 'equalto', 'class') | list %}
{% set public_classes = [] %}
{% for cls in all_classes %}
  {% if not cls.name.startswith('_') %}
    {% set _ = public_classes.append(cls) %}
  {% endif %}
{% endfor %}

{% set all_functions = element.children | selectattr('element_type', 'equalto', 'function') | list %}
{% set public_functions = [] %}
{% for func in all_functions %}
  {% if not func.name.startswith('_') %}
    {% set _ = public_functions.append(func) %}
  {% endif %}
{% endfor %}

<div class="docs-content">
  <div class="api-explorer">
    <header class="api-module-header">
      <div class="api-module-header__badges">
        <span class="api-badge api-badge--module">Module</span>
      </div>

      <div class="api-module-header__description">
        {%- call safe_section("description") -%}
        {%- include 'python/partials/module_description.md.jinja2' -%}
        {%- endcall -%}
      </div>

      {% if element.source_url %}
      <div class="api-module-header__source">
        <a href="{{ element.source_url }}" class="api-source-link" target="_blank" rel="noopener">
          View source
        </a>
      </div>
      {% endif %}
    </header>

    <div class="api-stats">
      <span class="api-stat">
        <span class="api-stat__count">{{ public_classes | length }}</span>
        <span class="api-stat__label">Classes</span>
      </span>
      <span class="api-stat">
        <span class="api-stat__count">{{ public_functions | length }}</span>
        <span class="api-stat__label">Functions</span>
      </span>
    </div>

    {#- Module aliases -#}
    {%- call safe_section("aliases") -%}
    {%- include 'python/partials/module_aliases.md.jinja2' -%}
    {%- endcall -%}

    {#- Module classes -#}
    {%- call safe_section("classes") -%}
    {#- Pass pre-calculated classes to avoid re-calculation -#}
    {% with public_classes=public_classes %}
    {%- include 'python/partials/module_classes.md.jinja2' -%}
    {% endwith %}
    {%- endcall -%}

    {#- Module functions -#}
    {%- call safe_section("functions") -%}
    {#- Pass pre-calculated functions to avoid re-calculation -#}
    {% with public_functions=public_functions %}
    {%- include 'python/partials/module_functions.md.jinja2' -%}
    {% endwith %}
    {%- endcall -%}
  </div>
</div>
{% endblock %}
