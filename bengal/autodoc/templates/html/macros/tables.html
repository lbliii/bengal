{#-
================================================================================
Table Macros

Reusable macros for rendering parameter tables, return types,
attributes, and other structured data as tables.

Usage:
  {% from 'html/macros/tables.html' import parameters_table, returns_section %}
  {{ parameters_table(method.metadata.parameters) }}
  {{ returns_section(method.metadata.returns) }}
================================================================================
-#}

{#-
Render a parameters table

Args:
    parameters: List of parameter dicts with name, type, default, description
    compact: Use compact styling for nested contexts
    show_default: Show default column (default: true)
-#}
{% macro parameters_table(parameters, compact=false, show_default=true) %}
{% if parameters %}
<div class="api-parameters">
  {% if not compact %}
  <h4 class="api-label">Parameters</h4>
  {% endif %}
  <table class="api-table{% if compact %} api-table--mini{% else %} api-table--compact{% endif %}">
    {% if not compact %}
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        {% if show_default %}<th>Default</th>{% endif %}
        <th>Description</th>
      </tr>
    </thead>
    {% endif %}
    <tbody>
      {% for param in parameters %}
      <tr>
        <td><code>{{ param.name }}</code></td>
        <td>{% if param.type %}<code>{{ param.type }}</code>{% else %}—{% endif %}</td>
        {% if show_default %}
        <td>{% if param.default %}<code>{{ param.default }}</code>{% else %}—{% endif %}</td>
        {% endif %}
        <td>{{ param.description | default('') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endmacro %}


{#-
Render a returns section

Args:
    returns: Dict with type and description, or just a type string
-#}
{% macro returns_section(returns) %}
{% if returns %}
<div class="api-returns">
  <h4 class="api-label">Returns</h4>
  <p>
    {% if returns is mapping %}
      {% if returns.type %}<code>{{ returns.type }}</code>{% endif %}
      {% if returns.type and returns.description %} — {% endif %}
      {{ returns.description | default('') }}
    {% else %}
      <code>{{ returns }}</code>
    {% endif %}
  </p>
</div>
{% endif %}
{% endmacro %}


{#-
Render a raises/exceptions section

Args:
    raises: List of dicts with type and description
-#}
{% macro raises_section(raises) %}
{% if raises %}
<div class="api-raises">
  <h4 class="api-label">Raises</h4>
  <ul class="api-raises__list">
    {% for exc in raises %}
    <li>
      <code>{{ exc.type }}</code>
      {% if exc.description %} — {{ exc.description }}{% endif %}
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}
{% endmacro %}


{#-
Render an attributes table (for classes/dataclasses)

Args:
    attributes: List of attribute dicts
    compact: Use compact styling
-#}
{% macro attributes_table(attributes, compact=false) %}
{% if attributes %}
<div class="api-attributes">
  {% if not compact %}
  <h4 class="api-subsection-title">Attributes</h4>
  {% endif %}
  <table class="api-table{% if compact %} api-table--mini{% else %} api-table--compact{% endif %}">
    {% if not compact %}
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    {% endif %}
    <tbody>
      {% for attr in attributes %}
      <tr>
        <td><code>{{ attr.name }}</code></td>
        <td>
          {% if attr.type_annotation or (attr.metadata and attr.metadata.type_annotation) %}
          <code>{{ attr.type_annotation | default(attr.metadata.type_annotation) }}</code>
          {% else %}—{% endif %}
        </td>
        <td>{{ attr.description | default('—') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endmacro %}


{#-
Render a properties table

Args:
    properties: List of property dicts
-#}
{% macro properties_table(properties) %}
{% if properties %}
<div class="api-properties">
  <h4 class="api-subsection-title">Properties</h4>
  <table class="api-table api-table--compact">
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {% for prop in properties %}
      <tr>
        <td><code>{{ prop.name }}</code></td>
        <td>
          {% if prop.return_type or (prop.metadata and prop.metadata.return_type) %}
          <code>{{ prop.return_type | default(prop.metadata.return_type) }}</code>
          {% else %}—{% endif %}
        </td>
        <td>{{ prop.description | default('—') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endmacro %}
