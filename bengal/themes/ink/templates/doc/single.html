{% extends "base.html" %}
{#
================================================================================
INK THEME - Documentation Page (Kida-Native)
================================================================================
Single documentation page with inline TOC and prev/next navigation.

KIDA FEATURES USED:
- {% let %} multi-let for grouped variable definitions
- Optional chaining (?.) for nested attribute access
- Null coalescing (??) for fallback values
- Pipeline operator (|>) for filter chains
- {% match %}...{% case %} for pattern matching
- {% spaceless %} for clean list output
================================================================================
#}

{# Multi-let for all template variables #}
{% let
_toc = get_toc(page) ?? [],
_has_toc = _toc | length > 0,
_reading_time = page?.reading_time ?? 0,
_show_reading_time = theme?.features?.content?.reading_time ?? false,
_show_prev_next = theme?.features?.navigation?.prev_next ?? true %}

{# Multi-let for navigation #}
{% let
_prev = get_prev_page(page),
_next = get_next_page(page),
_has_nav = _prev is defined or _next is defined %}

{% block content %}
<div class="container">
    <article class="content">
        {# Page header #}
        <header class="page-header">
            <h1 class="page-title">{{ page?.title ?? 'Untitled' }}</h1>

            {# Meta with pattern matching #}
            {% match _show_reading_time, _reading_time %}
            {% case true, time if time > 0 %}
            <div class="page-meta">
                <span class="reading-time">{{ time }} min read</span>
            </div>
            {% case _ %}
            {% end %}
        </header>

        {# Inline TOC #}
        {% if _has_toc %}
        <details class="toc-inline" open>
            <summary>Contents</summary>
            {% spaceless %}
            <ol>
                {% for item in _toc %}
                {# Tuple unpacking for cleaner access #}
                {% let (item_id, item_title) = (item?.id ?? '', item?.title ?? 'Section') %}
                <li>
                    <a href="#{{ item_id }}">{{ item_title }}</a>
                    {% if item?.children | default([]) | length > 0 %}
                    <ol>
                        {% for child in item.children %}
                        <li><a href="#{{ child?.id ?? '' }}">{{ child?.title ?? 'Subsection' }}</a></li>
                        {% end %}
                    </ol>
                    {% end %}
                </li>
                {% end %}
            </ol>
            {% end %}
        </details>
        {% end %}

        {# Content #}
        <div class="prose">
            {{ page?.content ?? '' | safe }}
        </div>

        {# Prev/Next Navigation #}
        {% if _show_prev_next and _has_nav %}
        <nav class="nav-prevnext">
            {% match _prev %}
            {% case prev if prev is defined %}
            <a href="{{ prev._path | absolute_url }}" class="prev">
                <span class="label">← Previous</span>
                <span class="title">{{ prev?.title ?? 'Previous' }}</span>
            </a>
            {% case _ %}
            <span></span>
            {% end %}

            {% match _next %}
            {% case next if next is defined %}
            <a href="{{ next._path | absolute_url }}" class="next">
                <span class="label">Next →</span>
                <span class="title">{{ next?.title ?? 'Next' }}</span>
            </a>
            {% case _ %}
            {% end %}
        </nav>
        {% end %}
    </article>
</div>
{% end %}
