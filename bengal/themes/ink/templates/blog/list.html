{% extends "base.html" %}
{#
================================================================================
INK THEME - Blog List (Kida-Native)
================================================================================
List of blog posts with excerpts.

KIDA FEATURES USED:
- {% let %} multi-let for grouped variable definitions
- Pipeline operator (|>) for left-to-right filter chains
- {% match %}...{% case %} for conditional display
- Optional chaining (?.) for safe access
- Null coalescing (??) for defaults
- {% continue %} for skipping draft posts
================================================================================
#}

{# Multi-let for template variables #}
{% let
    _posts = pages_by_section('blog') |> where('draft', false) |> sort(attribute='date', reverse=true),
    _page_title = page?.title ?? 'Blog',
    _page_description = page?.description ?? '',
    _has_posts = _posts | length > 0 %}

{% block content %}
<div class="container">
    <article class="content">
        <header class="page-header">
            <h1 class="page-title">{{ _page_title }}</h1>
            {% if _page_description | length > 0 %}
            <p class="lead">{{ _page_description }}</p>
            {% end %}
        </header>

        {# Post list with pattern matching for empty state #}
        {% match _has_posts %}
        {% case true %}
        <ul class="post-list">
            {% for post in _posts %}
            {# Skip drafts (safety) #}
            {% if post?.draft ?? false %}
                {% continue %}
            {% end %}

            {# Multi-let for post data #}
            {% let
                _post_title = post?.title ?? 'Untitled',
                _post_url = post?._path ?? '#',
                _post_excerpt = post?.excerpt ?? post?.description ?? '',
                _post_date = post?.date,
                _post_time = post?.reading_time ?? 0 %}

            <li class="post-item">
                <h2><a href="{{ _post_url | absolute_url }}">{{ _post_title }}</a></h2>

                {% if _post_excerpt | length > 0 %}
                <p class="excerpt">{{ _post_excerpt | truncate(200) }}</p>
                {% end %}

                <div class="meta">
                    {% match _post_date %}
                    {% case date if date is defined %}
                    <time datetime="{{ date | dateformat('%Y-%m-%d') }}">
                        {{ date | dateformat('%B %d, %Y') }}
                    </time>
                    {% case _ %}
                    {% end %}

                    {% if _post_time > 0 %}
                    <span> Â· {{ _post_time }} min read</span>
                    {% end %}
                </div>
            </li>
            {% end %}
        </ul>
        {% case false %}
        <p class="empty-state">No posts yet. Check back soon!</p>
        {% end %}
    </article>
</div>
{% end %}
