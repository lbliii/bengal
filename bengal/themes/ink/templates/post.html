{% extends "base.html" %}
{#
================================================================================
INK THEME - Blog Post (Kida-Native)
================================================================================
Single blog post with metadata and optional author info.

KIDA FEATURES USED:
- {% let %} multi-let for grouped variable definitions
- Optional chaining (?.) for nested access
- Null coalescing (??) for fallback values
- Pipeline operator (|>) for tag processing
- {% match %} for conditional display
- {% spaceless %} for clean tag list
================================================================================
#}

{# Multi-let for all template variables #}
{% let
    _title = page?.title ?? 'Untitled Post',
    _date = page?.date,
    _author = page?.author ?? '',
    _reading_time = page?.reading_time ?? 0,
    _tags = page?.tags ?? [],
    _has_tags = _tags | length > 0,
    _excerpt = page?.excerpt ?? page?.description ?? '' %}

{# Multi-let for navigation #}
{% let
    _prev = get_prev_page(page),
    _next = get_next_page(page),
    _has_nav = _prev is defined or _next is defined %}

{% block content %}
<div class="container">
    <article class="content">
        {# Post header #}
        <header class="page-header">
            <h1 class="page-title">{{ _title }}</h1>

            <div class="page-meta">
                {# Date #}
                {% match _date %}
                {% case date if date is defined %}
                <time datetime="{{ date | dateformat('%Y-%m-%d') }}">
                    {{ date | dateformat('%B %d, %Y') }}
                </time>
                {% case _ %}
                {% end %}

                {# Reading time #}
                {% if _reading_time > 0 %}
                <span class="reading-time">· {{ _reading_time }} min read</span>
                {% end %}

                {# Author #}
                {% if _author | length > 0 %}
                <span class="author">· {{ _author }}</span>
                {% end %}
            </div>
        </header>

        {# Tags #}
        {% if _has_tags %}
        {% spaceless %}
        <div class="tags">
            {% for tag in _tags %}
            <a href="{{ '/tags/' ~ (tag | slugify) ~ '/' | absolute_url }}" class="tag">{{ tag }}</a>
            {% end %}
        </div>
        {% end %}
        {% end %}

        {# Content #}
        <div class="prose">
            {{ page?.content ?? '' | safe }}
        </div>

        {# Prev/Next navigation #}
        {% if _has_nav %}
        <nav class="nav-prevnext">
            {% match _prev %}
            {% case prev if prev is defined %}
            <a href="{{ prev._path | absolute_url }}" class="prev">
                <span class="label">← Previous</span>
                <span class="title">{{ prev?.title ?? 'Previous' }}</span>
            </a>
            {% case _ %}
            <span></span>
            {% end %}

            {% match _next %}
            {% case next if next is defined %}
            <a href="{{ next._path | absolute_url }}" class="next">
                <span class="label">Next →</span>
                <span class="title">{{ next?.title ?? 'Next' }}</span>
            </a>
            {% case _ %}
            {% end %}
        </nav>
        {% end %}
    </article>
</div>
{% end %}
