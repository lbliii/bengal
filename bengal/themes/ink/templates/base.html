<!DOCTYPE html>
{#
================================================================================
INK THEME - Base Template (Kida-Native)
================================================================================
A minimalist, typography-focused template. Content is the interface.

KIDA FEATURES USED:
- {% let %} multi-let for grouped variable assignment
- Optional chaining (?.) for null-safe attribute access
- Null coalescing (??) for fallback values
- Pipeline operator (|>) for readable filter chains
- {% match %}...{% case %} for pattern matching
- {% spaceless %} for clean HTML output

Bengal provides: page, site, config, params (page.metadata alias), meta, section
================================================================================
#}

{# Multi-let for template-scoped variables #}
{% let
    _site_title = config?.title ?? 'Untitled Site',
    _page_title = page?.title ?? config?.title ?? 'Page',
    _page_url = page?._path ?? '/',
    _current_lang = current_lang(),
    _description = page?.description ?? config?.description ?? '' %}

{# Multi-let for config access with optional chaining #}
{% let
    _favicon = config?.site?.favicon,
    _search_enabled = config?.search?.enabled ?? false,
    _baseurl = config?.baseurl ?? '' %}

<html lang="{{ _current_lang }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {# Title with pattern matching #}
    <title>
    {%- match page?.title, _site_title -%}
        {%- case title, site if title and site and title != site -%}{{ title }} — {{ site }}
        {%- case title, _ if title -%}{{ title }}
        {%- case _, site if site -%}{{ site }}
        {%- case _ -%}Document
    {%- end -%}
    </title>

    {# Meta description #}
    {% if _description %}
    <meta name="description" content="{{ _description | truncate(160) }}">
    {% end %}

    {# Canonical URL #}
    {% if _baseurl %}
    <link rel="canonical" href="{{ canonical_url(_page_url) }}">
    {% end %}

    {# RSS Feed #}
    <link rel="alternate" type="application/rss+xml" title="{{ _site_title }}" href="{{ '/rss.xml' | absolute_url }}">

    {# Favicon with pattern matching #}
    {% match _favicon %}
    {% case path if path %}
    <link rel="icon" href="{{ path }}">
    {% case _ %}
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✒</text></svg>">
    {% end %}

    {# Bengal config meta #}
    <meta name="bengal:baseurl" content="{{ _baseurl }}">
    <meta name="bengal:index_url" content="{{ '/index.json' | absolute_url }}">

    {# Stylesheet #}
    <link rel="stylesheet" href="{{ asset_url('css/style.css') }}">

    {# Theme init #}
    <script>
        (function () {
            try {
                var stored = localStorage.getItem('bengal-theme');
                var prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)')?.matches;
                var theme = stored ?? (prefersDark ? 'dark' : 'light');
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            } catch (e) { }
        })();
    </script>

    {% block extra_head %}{% end %}
</head>

<body data-type="{{ page?.type ?? 'page' }}" data-variant="{{ page?.variant ?? '' }}" class="page-kind-{{ page?.kind ?? 'page' }}">

    {# Skip link #}
    <a href="#main-content" class="skip-link">Skip to main content</a>

    {# Header #}
    {% block site_header %}
    <header class="header-ink">
        <div class="container">
            {% spaceless %}
            <a href="{{ '/' | absolute_url }}" class="site-title">
                {{ site?.logo_text ?? _site_title }}
            </a>
            {% end %}

            <div class="header-actions">
                {# Search trigger #}
                {% if _search_enabled %}
                <button type="button" class="search-trigger" id="search-trigger">
                    {{ icon('magnifying-glass', size=16) }}
                    <span>Search</span>
                    <kbd>⌘K</kbd>
                </button>
                {% end %}

                {# Theme toggle #}
                <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    {% spaceless %}
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    {% end %}
                </button>
            </div>
        </div>
    </header>
    {% end %}

    {# Main content #}
    <main id="main-content">
        {% block content %}{% end %}
    </main>

    {# Footer #}
    {% block site_footer %}
    <footer>
        <div class="container">
            <p>&copy; {{ site?.build_time | dateformat('%Y') ?? now() | dateformat('%Y') }} {{ _site_title }}</p>
        </div>
    </footer>
    {% end %}

    {# Minimal JavaScript #}
    {% block site_scripts %}
    <script>
        // Theme toggle
        document.getElementById('theme-toggle')?.addEventListener('click', function() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? 'light' : 'dark');
            localStorage.setItem('bengal-theme', isDark ? 'light' : 'dark');
        });

        // Search keyboard shortcut
        document.addEventListener('keydown', function(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                window.location.href = '{{ "/search/" | absolute_url }}';
            }
        });
    </script>
    {% end %}

    {% block extra_js %}{% end %}
</body>

</html>
