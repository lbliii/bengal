{% extends "base.html" %}

{#
Documentation List Template

Three-column layout optimized for documentation section index pages:
- Left sidebar: Navigation tree
- Center: Content + Content tiles (children + related)
- Right sidebar: Contextual Graph + TOC + metadata

Usage: Set `template: doc/list.html` in frontmatter
Or set `type: doc` to auto-select this template

Features:
- Automatically displays child pages and subsections as tiles
- Disable with `show_children: false` in frontmatter
- Add header with `children_title: "In This Section"` (or false to hide)
- Show related pages with `show_related: true` (or number for limit)
- Change variant with `children_variant: "cards"` (compact | cards | minimal)
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation, toc with context %}
{% from 'partials/content-components.html' import tag_list, content_tiles with context %}

{% block content %}
{# Three-column documentation layout #}
<div class="docs-layout">
  {# Left Sidebar: Navigation #}
  <aside class="docs-sidebar" id="docs-sidebar" role="navigation" aria-label="Documentation navigation">
    {% include 'partials/docs-nav.html' %}
  </aside>

  {# Main Content #}
  <div class="docs-main">
    {# Page Hero: Breadcrumbs + Title + Description + Section Stats #}
    {# List pages default to 'overview' variant (shows page count instead of read time) #}
    {% set _list_hero_default = 'overview' %}
    {% include 'partials/page-hero.html' %}

    {# Article Content #}
    <article class="prose {% if page.metadata.get('css_class') %}{{ page.metadata.get('css_class') }}{% endif %}">

      {# Main content #}
      <div class="docs-content">
        {{ content | safe }}
      </div>

      {# Content tiles - children and optionally related pages #}
      {# Frontmatter options:
         - show_children: true/false (default: feature flag or true)
         - children_title: "In This Section" or false (default: none)
         - show_related: true/false/number (default: false)
         - children_variant: compact/cards/minimal (default: compact)
      #}
      {% set show_children_fm = page.metadata.get('show_children', none) if page else none %}
      {% set show_children_feature = 'content.children' in site.theme_config.features %}
      {% set show_children = show_children_fm if show_children_fm is not none else show_children_feature %}
      
      {% if show_children and (posts or subsections or page.metadata.get('show_related')) %}
      <div class="docs-children">
        {# Get frontmatter options #}
        {% set children_title = page.metadata.get('children_title', none) if page else none %}
        {% set show_related = page.metadata.get('show_related', false) if page else false %}
        {% set related_limit = show_related if show_related is number else 5 %}
        {% set children_variant = page.metadata.get('children_variant', 'compact') if page else 'compact' %}
        
        {{ content_tiles(
          title=children_title,
          children=posts,
          subsections=subsections,
          related=show_related,
          related_limit=related_limit,
          variant=children_variant,
          group_by='type' if show_related else none
        ) }}
      </div>
      {% endif %}

      {# Tags #}
      {% if page.tags %}
      <footer class="docs-footer">
        {{ tag_list(page.tags) }}
      </footer>
      {% endif %}
    </article>

    {# Page navigation (prev/next) at bottom #}
    {{ page_navigation(page) }}
  </div>

  {# Right Sidebar: Contextual Graph + TOC + Metadata #}
  {% if toc_items %}
  <aside class="docs-toc" role="complementary" aria-label="Table of contents">
    {# Contextual Graph Minimap - shows connections to current page #}
    <div class="graph-contextual" data-page-url="{{ page.url }}">
      {# Placeholder - will be replaced by JavaScript #}
      <div class="graph-contextual-container graph-loading"
        style="min-height: 200px; opacity: 1 !important; visibility: visible !important;">
      </div>
    </div>

    {# Table of Contents #}
    {{ toc(toc_items=toc_items, toc=toc, page=page) }}
  </aside>
  {% endif %}
</div>

{# Mobile sidebar toggle button #}
<button class="docs-sidebar-toggle" aria-label="Toggle navigation sidebar" aria-expanded="false"
  aria-controls="docs-sidebar">
  {{ icon('list', size=20) }}
</button>

{# Sidebar overlay for mobile #}
<div class="docs-sidebar-overlay" aria-hidden="true"></div>
{% endblock %}

{# Sidebar toggle functionality is handled by interactive.js #}
