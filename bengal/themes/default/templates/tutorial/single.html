{% extends "base.html" %}

{#
Tutorial Single Page Template

Used for individual tutorial pages. Optimized for step-by-step learning
with clear navigation, progress indicators, and helpful metadata.

Usage: Set `type: tutorial` in frontmatter or use cascade from section

Context variables:
- page: Tutorial page object
- content: Rendered tutorial content
- toc: Table of contents
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation %}

{% block content %}
<div class="container">
    {# Action Bar: Breadcrumbs + Share #}
    {% include 'partials/action-bar.html' %}

    <div class="tutorial-page-layout {% if toc %}tutorial-with-toc{% endif %}">
        <article class="tutorial-page prose {% if params.css_class %}{{ params.css_class }}{% endif %}">
            <header class="page-header">
                {# Tutorial Icon #}
                {% if params.icon %}
                <div class="tutorial-page-icon">{{ params.icon }}</div>
                {% endif %}

                <h1>{{ page.title }}</h1>

                {% if params.description %}
                <p class="lead">{{ params.description }}</p>
                {% endif %}

                {# Tutorial Metadata Bar #}
                <div class="tutorial-page-meta">
                    {# Difficulty #}
                    {% if params.difficulty %}
                    <span class="tutorial-badge tutorial-badge-{{ params.difficulty }}">
                        {{ params.difficulty | capitalize }}
                    </span>
                    {% endif %}

                    {# Time Estimate #}
                    {% if params.time or params.duration %}
                    <span class="tutorial-meta-item">
                        {{ icon('clock', size=16) }}
                        {{ params.time | default(params.duration) }}
                    </span>
                    {% endif %}

                    {# Last Updated #}
                    {% if page.date %}
                    <span class="tutorial-meta-item">
                        {{ icon('calendar', size=16) }}
                        Updated {{ page.date | time_ago }}
                    </span>
                    {% endif %}
                </div>

                {# Prerequisites #}
                {% if params.prerequisites %}
                <div class="tutorial-prerequisites">
                    <h4>{{ t('tutorial.prerequisites', default='Prerequisites') }}</h4>
                    <ul>
                        {% for prereq in params.prerequisites %}
                        <li>
                            {# Try to resolve as page reference (supports path, slug, or id:xxx) #}
                            {% if prereq is string %}
                            {% set prereq_page = doc(prereq, site.indexes.crossref) if site.indexes.crossref else none
                            %}
                            {% if prereq_page %}
                            <a href="{{ prereq_page.href }}" class="tutorial-prereq-link">{{ prereq_page.title }}</a>
                            {% else %}
                            {# Fallback: if it looks like a path/slug, try ref() for link generation #}
                            {% set prereq_ref = ref(prereq, site.indexes.crossref) if site.indexes.crossref else none %}
                            {% if prereq_ref and '<a' in prereq_ref %} {{ prereq_ref | safe }} {% else %} {{ prereq }}
                                {% endif %} {% endif %} {% else %} {{ prereq }} {% endif %} </li>
                                {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {# What You'll Learn #}
                {% if params.learning_objectives or params.objectives %}
                <div class="tutorial-objectives">
                    <h4>{{ t('tutorial.what_you_will_learn', default="What you'll learn") }}</h4>
                    <ul>
                        {% for objective in (params.learning_objectives |
                        default(params.objectives)) %}
                        <li>{{ objective }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </header>

            {# Main Tutorial Content #}
            <div class="tutorial-content">
                {{ content | safe }}
            </div>

            {# What's Next / Further Reading #}
            {% if params.next_steps or params.further_reading %}
            <footer class="tutorial-footer">
                {% if params.next_steps %}
                <div class="tutorial-next-steps">
                    <h3>{{ t('tutorial.whats_next', default="What's Next?") }}</h3>
                    <ul>
                        {% for step in params.next_steps %}
                        <li>{{ step }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if params.further_reading %}
                <div class="tutorial-further-reading">
                    <h3>{{ t('tutorial.further_reading', default='Further Reading') }}</h3>
                    <ul>
                        {% for resource in params.further_reading %}
                        <li>{{ resource }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </footer>
            {% endif %}
        </article>

        {# Right Sidebar: TOC #}
        {% if toc %}
        <aside class="tutorial-sidebar">
            <nav class="toc" aria-label="Table of contents">
                <h2 class="toc-title">Tutorial Steps</h2>
                <div class="toc-content">
                    {{ toc | safe }}
                </div>
            </nav>
        </aside>
        {% endif %}
    </div>

</div>

{# Prominent Prev/Next Navigation #}
<div class="tutorial-navigation">
    {{ page_navigation(page) }}
</div>

{# Related Tutorials #}
{% if page.tags %}
{% set related = page.related_posts[:3] %}
{% if related %}
<aside class="related-tutorials">
    <div class="container">
        <h2>{{ t('tutorial.related', default='Related Tutorials') }}</h2>
        <div class="tutorial-grid">
            {% for tutorial in related %}
            <article class="tutorial-card gradient-border fluid-combined">
                <div class="tutorial-card-header">
                    {% if tutorial.metadata.icon %}
                    <span class="tutorial-icon">{{ tutorial.metadata.icon }}</span>
                    {% else %}
                    <span class="tutorial-icon">ðŸ“–</span>
                    {% endif %}
                    <h3 class="tutorial-title">
                        <a href="{{ tutorial.href }}">{{ tutorial.title }}</a>
                    </h3>
                </div>
                <div class="tutorial-card-content">
                    {% if tutorial.metadata.description %}
                    <p class="tutorial-description">{{ tutorial.metadata.description | truncate(100) }}</p>
                    {% endif %}
                    {% if tutorial.metadata.difficulty %}
                    <span class="tutorial-badge tutorial-badge-{{ tutorial.metadata.difficulty }}">
                        {{ tutorial.metadata.difficulty | capitalize }}
                    </span>
                    {% endif %}
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</aside>
{% endif %}
{% endif %}
{% endblock %}
