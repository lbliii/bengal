<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    {# Title #}
    <title>{% block title %}{{ page.title | default(site.config.title) }}{% if page and page.title %} - {{ site.config.title }}{% endif %}{% endblock %}</title>
    
    {# Meta Description - Auto-generate if not provided #}
    {% if page and page.metadata.description %}
    <meta name="description" content="{{ page.metadata.description }}">
    {% elif page and page.content %}
    <meta name="description" content="{{ page.content | meta_description(160) }}">
    {% else %}
    <meta name="description" content="{{ site.config.description | default('') }}">
    {% endif %}
    
    {# Meta Keywords - use page.keywords or fallback to tags #}
    {% if page and page.keywords %}
    <meta name="keywords" content="{{ page.keywords | join(', ') }}">
    {% elif page and page.tags %}
    <meta name="keywords" content="{{ page.tags | meta_keywords(10) }}">
    {% endif %}
    
    {# Open Graph / Facebook #}
    <meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
    <meta property="og:title" content="{{ page.title | default(site.config.title) }}">
    {% if page and page.metadata.description %}
    <meta property="og:description" content="{{ page.metadata.description }}">
    {% elif page and page.content %}
    <meta property="og:description" content="{{ page.content | meta_description(160) }}">
    {% endif %}
    {% if site.config.baseurl %}
    <meta property="og:url" content="{{ canonical_url(page.url | default('/')) }}">
    {% endif %}
    {# Open Graph Image #}
    {% if page and page.metadata.image %}
    <meta property="og:image" content="{{ og_image(page.metadata.image) }}">
    {% elif site.config.og_image %}
    <meta property="og:image" content="{{ og_image(site.config.og_image) }}">
    {% endif %}
    
    {# Twitter Card #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title | default(site.config.title) }}">
    {% if page and page.metadata.description %}
    <meta name="twitter:description" content="{{ page.metadata.description }}">
    {% elif page and page.content %}
    <meta name="twitter:description" content="{{ page.content | meta_description(160) }}">
    {% endif %}
    {% if page and page.metadata.image %}
    <meta name="twitter:image" content="{{ og_image(page.metadata.image) }}">
    {% elif site.config.og_image %}
    <meta name="twitter:image" content="{{ og_image(site.config.og_image) }}">
    {% endif %}
    
    {# Canonical URL #}
    {% if site.config.baseurl %}
    <link rel="canonical" href="{{ canonical_url(page.url | default('/')) }}">
    {% endif %}
    
    {# RSS Feed #}
    <link rel="alternate" type="application/rss+xml" title="{{ site.config.title }} RSS Feed" href="/rss.xml">
    
    {# Favicon - only include if configured #}
    {% if site.config.favicon %}
    <link rel="icon" type="image/png" href="{{ site.config.favicon }}">
    {% endif %}
    
    {# Stylesheets #}
    <link rel="stylesheet" href="{{ asset_url('css/style.css') }}">
    
    {# Theme initialization (prevent flash) #}
    <script>
        (function() {
            const theme = localStorage.getItem('bengal-theme') || 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="page-kind-{{ page.kind }} {% if page.draft %}draft-page{% endif %} {% if page | has_tag('featured') %}featured-content{% endif %}">
    {# Skip to main content for accessibility #}
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    {# Header #}
    <header role="banner">
        <nav role="navigation" aria-label="Main navigation">
            <div class="container">
                {# Logo / Site Title #}
                <a href="/" class="logo">{{ site.config.title }}</a>
                
                {# Desktop Navigation #}
                <div class="nav-main hidden-mobile">
                    {% set main_menu = get_menu('main') %}
                    {% if main_menu %}
                    <ul>
                        {% for item in main_menu %}
                        <li class="{{ 'active' if item.active else '' }} {{ 'active-trail' if item.active_trail else '' }}">
                            <a href="{{ item.url }}">{{ item.name }}</a>
                            {% if item.children %}
                            <ul class="submenu">
                                {% for child in item.children %}
                                <li class="{{ 'active' if child.active else '' }}">
                                    <a href="{{ child.url }}">{{ child.name }}</a>
                                </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </li>
                        {% endfor %}
                        {% block nav_items %}{% endblock %}
                    </ul>
                    {% endif %}
                    
                    {# Theme Toggle #}
                    <button class="theme-toggle" aria-label="Toggle dark mode" title="Toggle theme">
                        <svg class="icon-sun" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                        <svg class="icon-moon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                        </svg>
                    </button>
                </div>
                
                {# Mobile Menu Toggle #}
                <button class="mobile-nav-toggle visible-mobile" aria-label="Open menu" aria-expanded="false">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </nav>
    </header>
    
    {# Mobile Navigation #}
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <div class="mobile-nav-header">
            <span class="logo">{{ site.config.title }}</span>
            <button class="mobile-nav-close" aria-label="Close menu">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        {% set main_menu = get_menu('main') %}
        {% if main_menu %}
        <ul>
            {% for item in main_menu %}
            <li class="{{ 'has-submenu' if item.children else '' }} {{ 'active' if item.active else '' }}">
                <a href="{{ item.url }}">{{ item.name }}</a>
                {% if item.children %}
                <ul class="submenu">
                    {% for child in item.children %}
                    <li class="{{ 'active' if child.active else '' }}">
                        <a href="{{ child.url }}">{{ child.name }}</a>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}
            {% block mobile_nav_items %}{% endblock %}
        </ul>
        {% endif %}
    </nav>
    
    {# Main Content #}
    <main id="main-content" role="main">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>
    
    {# Footer #}
    <footer role="contentinfo">
        <div class="container">
            {# Popular Tags Widget - dogfooding popular_tags() function #}
            {% include 'partials/popular-tags.html' %}
            
            <p class="footer-copyright">
                &copy; 2025 {{ site.config.title }} | Built with <a href="https://github.com/bengal-ssg/bengal" rel="noopener">Bengal SSG</a>
            </p>
            {% set footer_menu = get_menu('footer') %}
            {% if footer_menu %}
            <ul class="footer-links">
                {% for item in footer_menu %}
                <li><a href="{{ item.url }}">{{ item.name }}</a></li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </footer>
    
    {# JavaScript #}
    <script src="{{ asset_url('js/theme-toggle.js') }}"></script>
    <script src="{{ asset_url('js/mobile-nav.js') }}"></script>
    <script src="{{ asset_url('js/tabs.js') }}"></script>
    <script src="{{ asset_url('js/main.js') }}"></script>
    <script src="{{ asset_url('js/interactive.js') }}"></script>
    <script src="{{ asset_url('js/copy-link.js') }}"></script>
    <script src="{{ asset_url('js/lightbox.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

