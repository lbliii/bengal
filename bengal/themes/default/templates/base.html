<!DOCTYPE html>
{#
================================================================================
PERFORMANCE OPTIMIZATION: Cache expensive lookups once per render
================================================================================
These cached variables eliminate repeated defensive checks (34+ instances of
"page is defined and page") and redundant function calls (get_menu_lang, etc.)

See: plan/active/rfc-template-performance-optimization.md
================================================================================
#}
{% set _page = page if page is defined else none %}
{% set _has_page = _page is not none %}
{% set _page_title = _page.title if (_has_page and _page.title is defined) else '' %}
{% set _page_url = _page.relative_url if (_has_page and _page.relative_url is defined) else '/' %}
{% set _current_lang = current_lang() %}
{% set _main_menu = get_menu_lang('main', _current_lang) %}
{% set _auto_nav = get_auto_nav() if _main_menu | length == 0 else [] %}
{% set _footer_menu = get_menu_lang('footer', _current_lang) %}
{% set _site_title = site.config.title %}

<html lang="{{ _current_lang }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    {# Title - uses cached variables #}
    <title>{% block title %}{{ _page_title if _page_title else _site_title }}{% if _page_title %} - {{ _site_title }}{%
        endif %}{% endblock %}
    </title>

    {# Meta description - automatically pre-computed by renderer (page.meta_description cached_property) #}
    {% set meta_desc = meta_desc | default(site.config.get('description'), '') %}

    {# Meta Description - Auto-generate if not provided #}
    <meta name="description" content="{{ meta_desc }}">

    {# Meta Keywords - use page.keywords or fallback to tags #}
    {% if _has_page and _page.keywords is defined and _page.keywords %}
    <meta name="keywords" content="{{ _page.keywords | join(', ') }}">
    {% elif _has_page and _page.tags is defined and _page.tags %}
    <meta name="keywords" content="{{ _page.tags | meta_keywords(10) }}">
    {% endif %}

    {# Robots directive for hidden/unlisted pages #}
    {% if _has_page and _page.robots_meta is defined and _page.robots_meta != 'index, follow' %}
    <meta name="robots" content="{{ _page.robots_meta }}">
    {% endif %}

    {# Open Graph / Facebook #}
    <meta property="og:type" content="{% if _has_page %}article{% else %}website{% endif %}">
    <meta property="og:title" content="{{ _page_title if _page_title else _site_title }}">
    {% if meta_desc %}
    <meta property="og:description" content="{{ meta_desc }}">
    {% endif %}
    {% if site.config.baseurl %}
    {# Use relative_url for canonical URLs (canonical_url adds baseurl) #}
    <meta property="og:url" content="{{ canonical_url(_page_url) }}">
    {% endif %}
    {# Open Graph Image #}
    {% if _has_page and _page.metadata is defined and _page.metadata.get('image') %}
    <meta property="og:image" content="{{ og_image(_page.metadata.get('image')) }}">
    {% elif site.config.get('og_image') %}
    <meta property="og:image" content="{{ og_image(site.config.get('og_image')) }}">
    {% endif %}

    {# Twitter Card #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _page_title if _page_title else _site_title }}">
    {% if meta_desc %}
    <meta name="twitter:description" content="{{ meta_desc }}">
    {% endif %}
    {% if _has_page and _page.metadata is defined and _page.metadata.get('image') %}
    <meta name="twitter:image" content="{{ og_image(_page.metadata.get('image')) }}">
    {% elif site.config.get('og_image') %}
    <meta name="twitter:image" content="{{ og_image(site.config.get('og_image')) }}">
    {% endif %}

    {# Bengal config meta for JS to read without template tags inside scripts #}
    <meta name="bengal:search_preload" content="{{ site.config.get('search_preload', 'smart') }}">
    <meta name="bengal:baseurl" content="{{ site.config.baseurl or '' }}">
    <meta name="bengal:index_url" content="{{ '/index.json' | absolute_url }}">
    <meta name="bengal:search_index_url" content="{{ '/search-index.json' | absolute_url }}">

    {# Canonical URL #}
    {% if site.config.baseurl %}
    {# Use relative_url for canonical URLs (canonical_url adds baseurl) #}
    <link rel="canonical" href="{{ canonical_url(_page_url) }}">
    {% endif %}

    {# RSS Feed (locale-aware when i18n prefix strategy is enabled) #}
    {% set _lang = _current_lang %}
    {% set _i18n = site.config.get('i18n', {}) %}
    {% set _rss_href = '/rss.xml' %}
    {% if _i18n and _i18n.get('strategy') == 'prefix' %}
    {% set _default_lang = _i18n.get('default_language', 'en') %}
    {% set _default_in_subdir = _i18n.get('default_in_subdir', False) %}
    {% if _lang and (_default_in_subdir or _lang != _default_lang) %}
    {% set _rss_href = '/' ~ _lang ~ '/rss.xml' %}
    {% endif %}
    {% endif %}
    <link rel="alternate" type="application/rss+xml" title="{{ site.config.title }} RSS Feed" href="{{ _rss_href }}">

    {# hreflang alternates for translated pages #}
    {% for alt in alternate_links(page) %}
    <link rel="alternate" hreflang="{{ alt.hreflang }}" href="{{ alt.href }}">
    {% endfor %}

    {# Favicon #}
    {% set favicon_path = site.config.get('site', {}).get('favicon') %}
    {% if favicon_path %}
    <link rel="icon" type="image/png" href="{{ favicon_path }}">
    {% else %}
    <link rel="icon" type="image/x-icon" href="{{ asset_url('favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ asset_url('favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ asset_url('favicon-32x32.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset_url('apple-touch-icon.png') }}">
    <link rel="manifest" href="{{ asset_url('site.webmanifest') }}">
    {% endif %}

    {# Preconnect to CDN origins for faster resource loading #}
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://d3js.org" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://d3js.org">

    {# Fonts - Preload critical fonts, load CSS non-blocking #}
    {% if site.config.get('fonts') %}
    {# Preload the most critical font weight for faster LCP #}
    <link rel="preload" href="{{ asset_url('fonts/outfit-700.woff2') }}" as="font" type="font/woff2" crossorigin>
    {# Load font CSS with non-blocking pattern #}
    <link rel="preload" href="{{ asset_url('fonts.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="{{ asset_url('fonts.css') }}">
    </noscript>
    {% endif %}

    {# Stylesheets - main CSS (render-blocking, but cached) #}
    <link rel="stylesheet" href="{{ asset_url('css/style.css') }}">

    {# Theme configuration defaults from bengal.toml #}
    <script>
        window.BENGAL_THEME_DEFAULTS = {
            appearance: '{{ site.theme_config.default_appearance }}',
            palette: '{{ site.theme_config.default_palette }}'
        };
    </script>

    {# Theme & Palette initialization - INLINED to prevent FOUC (must be synchronous) #}
    <script>
        (function () {
            try {
                var defaults = window.BENGAL_THEME_DEFAULTS || { appearance: 'system', palette: '' };
                var defaultAppearance = defaults.appearance;
                if (defaultAppearance === 'system') {
                    defaultAppearance = (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
                        ? 'dark' : 'light';
                }
                var storedTheme = localStorage.getItem('bengal-theme');
                var storedPalette = localStorage.getItem('bengal-palette');
                var theme = storedTheme ? (storedTheme === 'system' ? defaultAppearance : storedTheme) : defaultAppearance;
                var palette = storedPalette ?? defaults.palette;
                document.documentElement.setAttribute('data-theme', theme);
                if (palette) { document.documentElement.setAttribute('data-palette', palette); }
            } catch (e) { document.documentElement.setAttribute('data-theme', 'light'); }
        })();
    </script>

    {% block extra_head %}{% endblock %}
    {# Generator and build meta #}
    {% include 'partials/meta-generator.html' %}

    {# Optional JSON bootstrap for client-side scripts #}
    {% if config.get('expose_metadata_json') %}
    <script id="bengal-bootstrap" type="application/json">{{ bengal | jsonify }}</script>
    <script>
        (function () {
            var el = document.getElementById('bengal-bootstrap');
            if (el) { window.__BENGAL__ = JSON.parse(el.textContent || '{}'); }
        })();
    </script>
    {% endif %}
</head>

<body
    class="page-kind-{{ _page.kind if (_has_page and _page.kind is defined) else 'page' }} {% if (_has_page and _page.draft is defined and _page.draft) %}draft-page{% endif %} {% if (_has_page and _page.hidden is defined and _page.hidden) %}hidden-page{% endif %} {% if (_has_page and _page.tags is defined and (_page | has_tag('featured'))) %}featured-content{% endif %}">
    {# Skip to main content for accessibility - Feature: accessibility.skip_link #}
    {% if 'accessibility.skip_link' in site.theme_config.features %}
    <a href="#main-content" class="skip-link">Skip to main content</a>
    {% endif %}

    {# Search Modal (Cmd/Ctrl+K) #}
    {% include 'partials/search-modal.html' %}

    {# Header #}
    <header role="banner">
        <nav role="navigation" aria-label="Main navigation">
            <div class="container">
                {# Logo / Site Title #}
                <a href="{{ '/' | absolute_url }}" class="logo">
                    {% set _logo_image = site.config.get('logo_image') or site.config.get('site', {}).get('logo_image')
                    %}
                    {% set _logo_text = site.config.get('logo_text') or site.config.get('site', {}).get('logo_text') %}
                    {% if _logo_image %}
                    <img src="{{ _logo_image | absolute_url }}" alt="{{ _site_title }}" class="brand-image" />
                    {% elif _logo_text %}
                    <span class="brand-text">{{ _logo_text }}</span>
                    {% else %}
                    <span class="brand-text">{{ _site_title }}</span>
                    {% endif %}
                </a>

                {# Desktop Navigation - uses cached _main_menu and _auto_nav from top of template #}
                <div class="nav-main hidden-mobile">
                    {% if _main_menu or _auto_nav %}
                    <ul>
                        {# Manual menu items (if configured) #}
                        {% if _main_menu %}
                        {% for item in _main_menu %}
                        <li
                            class="{{ 'active' if item.active else '' }} {{ 'active-trail' if item.active_trail else '' }}">
                            <a href="{{ item.url | absolute_url }}">{{ item.name }}</a>
                            {% if item.children %}
                            <ul class="submenu">
                                {% for child in item.children %}
                                <li class="{{ 'active' if child.active else '' }}">
                                    <a href="{{ child.url | absolute_url }}">{{ child.name }}</a>
                                </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </li>
                        {% endfor %}
                        {% endif %}

                        {# Auto-discovered nav items (if no manual config) #}
                        {% if _auto_nav %}
                        {# Always show Home first in auto mode #}
                        <li class="{{ 'active' if _page_url == '/' else '' }}">
                            <a href="{{ '/' | absolute_url }}">Home</a>
                        </li>
                        {% for item in _auto_nav %}
                        <li
                            class="{{ 'active' if (_page_url is string and _page_url.startswith(item.relative_url) and item.relative_url != '/') else '' }}">
                            <a href="{{ item.url | absolute_url }}">{{ item.name }}</a>
                        </li>
                        {% endfor %}
                        {% endif %}

                        {# Search - Modal trigger if enabled, otherwise link to search page #}
                        {% set search_config = site.config.get('search', {}) %}
                        {% set ui_config = search_config.get('ui', {}) %}
                        {% set modal_enabled = ui_config.get('modal', false) %}
                        <li>
                            {% if modal_enabled %}
                            <button type="button" class="nav-search-trigger" id="nav-search-trigger" title="Search (⌘K)"
                                aria-label="Open search">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" aria-hidden="true">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <span>Search</span>
                                <kbd class="nav-search-shortcut">⌘K</kbd>
                            </button>
                            {% else %}
                            <a href="{{ '/search/' | absolute_url }}" title="Search (⌘K)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <span>Search</span>
                            </a>
                            {% endif %}
                        </li>
                        {# GitHub link - only show if not bundled in Dev dropdown #}
                        {% set github_bundled = false %}
                        {% if site._dev_menu_metadata is defined %}
                        {% set github_bundled = site._dev_menu_metadata.get("github_bundled", false) %}
                        {% endif %}
                        {% if site.config.params and site.config.params.repo_url and not github_bundled %}
                        <li>
                            <a href="{{ site.config.params.repo_url }}" target="_blank" rel="noopener"
                                title="GitHub Repository" data-external="true" aria-label="GitHub (opens in new tab)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                                </svg>
                                <span>GitHub</span>
                            </a>
                        </li>
                        {% endif %}
                        {% block nav_items %}{% endblock %}
                    </ul>
                    {% endif %}

                </div>

                {# Theme Controls - Desktop Only #}
                <div class="theme-controls-desktop hidden-mobile">
                    {% include 'partials/theme-controls.html' %}
                </div>

                {# Mobile Menu Toggle #}
                <button class="mobile-nav-toggle visible-mobile" aria-label="Open menu" aria-expanded="false">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </nav>
    </header>

    {# Mobile Navigation - uses cached _main_menu and _auto_nav from top of template #}
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <div class="mobile-nav-header">
            <span class="logo">
                {% set _logo_image = site.config.get('logo_image') or site.config.get('site', {}).get('logo_image') %}
                {% set _logo_text = site.config.get('logo_text') or site.config.get('site', {}).get('logo_text') %}
                {% if _logo_image %}
                <img src="{{ _logo_image | absolute_url }}" alt="{{ _site_title }}" class="brand-image" />
                {% elif _logo_text %}
                <span class="brand-text">{{ _logo_text }}</span>
                {% else %}
                <span class="brand-text">{{ _site_title }}</span>
                {% endif %}
            </span>
            <button class="mobile-nav-close" aria-label="Close menu">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        {% if _main_menu or _auto_nav %}
        <ul>
            {# Manual menu items (if configured) #}
            {% if _main_menu %}
            {% for item in _main_menu %}
            <li class="{{ 'has-submenu' if item.children else '' }} {{ 'active' if item.active else '' }}">
                <a href="{{ item.url | absolute_url }}">{{ item.name }}</a>
                {% if item.children %}
                <ul class="submenu">
                    {% for child in item.children %}
                    <li class="{{ 'active' if child.active else '' }}">
                        <a href="{{ child.url | absolute_url }}">{{ child.name }}</a>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}
            {% endif %}

            {# Auto-discovered nav items (if no manual config) #}
            {% if _auto_nav %}
            {# Always show Home first in auto mode #}
            <li class="{{ 'active' if _page_url == '/' else '' }}">
                <a href="{{ '/' | absolute_url }}">Home</a>
            </li>
            {% for item in _auto_nav %}
            <li
                class="{{ 'active' if (_page_url is string and _page_url.startswith(item.relative_url) and item.relative_url != '/') else '' }}">
                <a href="{{ item.url | absolute_url }}">{{ item.name }}</a>
            </li>
            {% endfor %}
            {% endif %}

            {# GitHub link - only show if not bundled in Dev dropdown #}
            {% set github_bundled = false %}
            {% if site._dev_menu_metadata is defined %}
            {% set github_bundled = site._dev_menu_metadata.get("github_bundled", false) %}
            {% endif %}
            {% if site.config.params and site.config.params.repo_url and not github_bundled %}
            <li>
                <a href="{{ site.config.params.repo_url }}" target="_blank" rel="noopener">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                        style="margin-right: 8px; vertical-align: text-bottom;">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                    GitHub
                </a>
            </li>
            {% endif %}

            {% block mobile_nav_items %}{% endblock %}
        </ul>
        {% endif %}

        {# Theme Controls - Mobile Only #}
        <div class="mobile-nav-footer">
            {% include 'partials/theme-controls.html' %}
        </div>
    </nav>

    {# Main Content #}
    <main id="main-content" role="main">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    {# Footer #}
    <footer role="contentinfo">
        <div class="container">
            {# Popular Tags Widget removed to avoid duplicate tags on section index pages #}

            <div class="footer-bottom">
                <div class="footer-left">
                    <p class="footer-copyright">
                        &copy; {{ site.build_time | dateformat('%Y') }} {{ _site_title }}
                    </p>
                    {% if _footer_menu %}
                    <ul class="footer-links">
                        {% for item in _footer_menu %}
                        <li><a href="{{ item.url | absolute_url }}">{{ item.name }}</a></li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                <div class="footer-right">
                    <a href="https://github.com/lbliii/bengal" rel="noopener" class="bengal-badge"
                        aria-label="Built with Bengal" data-tooltip="Built with Bengal" title="Built with Bengal">
                        <span class="cat cat-contemplative">
                            <span class="cat-tail">ᓚ</span><span class="cat-body">ᘏ</span><span
                                class="cat-head">ᗢ</span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    {# ============================================================== #}
    {# JavaScript Loading Strategy (Render Performance Optimized) #}
    {# ============================================================== #}
    {# All scripts use defer to avoid render-blocking. #}
    {# Heavy libraries (Mermaid, D3, Tabulator) are lazy-loaded only #}
    {# when their features are present on the page. #}
    {# #}
    {# When bundle_js is enabled in config, all theme JS is bundled #}
    {# into a single file to reduce HTTP requests on mobile. #}
    {# ============================================================== #}

    {% set _bundle_js = site.config.get('assets', {}).get('bundle_js', false) %}

    {% if _bundle_js %}
    {# Bundled JS - Single file containing all theme JavaScript #}
    {# Reduces HTTP requests from ~20 to 3 for better mobile performance #}
    <script defer src="{{ asset_url('js/bundle.js') }}"></script>
    {# Third-party libraries (not bundled - already optimized) #}
    <script defer src="{{ asset_url('js/lunr.min.js') }}"></script>
    {% else %}
    {# Individual Scripts - Better for development/debugging #}
    <script defer src="{{ asset_url('js/utils.js') }}"></script>
    <script defer src="{{ asset_url('js/theme-toggle.js') }}"></script>
    <script defer src="{{ asset_url('js/mobile-nav.js') }}"></script>
    <script defer src="{{ asset_url('js/tabs.js') }}"></script>
    <script defer src="{{ asset_url('js/toc.js') }}"></script>
    <script defer src="{{ asset_url('js/action-bar.js') }}"></script>
    <script defer src="{{ asset_url('js/main.js') }}"></script>
    <script defer src="{{ asset_url('js/interactive.js') }}"></script>
    <script defer src="{{ asset_url('js/copy-link.js') }}"></script>
    <script defer src="{{ asset_url('js/holo.js') }}"></script>
    {# Lightbox JS - Feature: content.lightbox #}
    {% if 'content.lightbox' in site.theme_config.features %}
    <script defer src="{{ asset_url('js/lightbox.js') }}"></script>
    {% endif %}

    {# Search - Core scripts with defer #}
    <script defer src="{{ asset_url('js/lunr.min.js') }}"></script>
    <script defer src="{{ asset_url('js/search.js') }}"></script>
    <script defer src="{{ asset_url('js/search-page.js') }}"></script>
    <script defer src="{{ asset_url('js/search-modal.js') }}"></script>

    {# Session path tracker - lightweight, always load #}
    <script defer src="{{ asset_url('js/session-path-tracker.js') }}"></script>

    {# Lazy-loaded Libraries - URLs injected here, logic in external file #}
    <script>
        window.BENGAL_LAZY_ASSETS = {
            tabulator: '{{ asset_url("js/tabulator.min.js") }}',
            dataTable: '{{ asset_url("js/data-table.js") }}',
            mermaidToolbar: '{{ asset_url("js/mermaid-toolbar.js") }}',
            mermaidTheme: '{{ asset_url("js/mermaid-theme.js") }}',
            graphMinimap: '{{ asset_url("js/graph-minimap.js") }}',
            graphContextual: '{{ asset_url("js/graph-contextual.js") }}'
        };
    </script>
    <script defer src="{{ asset_url('js/lazy-loaders.js') }}"></script>

    {# Smart search index preloading #}
    <script defer src="{{ asset_url('js/search-preload.js') }}"></script>
    {% endif %}

    {% block extra_js %}{% endblock %}

    {# Back to Top Button - Feature: navigation.back_to_top #}
    {% if 'navigation.back_to_top' in site.theme_config.features %}
    <button class="back-to-top" aria-label="Scroll to top" title="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="19" x2="12" y2="5" stroke="currentColor"></line>
            <polyline points="5 12 12 5 19 12" stroke="currentColor"></polyline>
        </svg>
    </button>
    {% endif %}

    {# Image Lightbox - Feature: content.lightbox #}
    {% if 'content.lightbox' in site.theme_config.features %}
    <div class="lightbox" role="dialog" aria-label="Image lightbox" aria-hidden="true">
        <img class="lightbox__image" alt="">
        <button class="lightbox__close" aria-label="Close lightbox">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <div class="lightbox__caption"></div>
    </div>
    {% endif %}

    {# Dev-only live reload is now injected by the server automatically via LiveReloadMixin #}
</body>

</html>