{% extends "base.html" %}

{#
Generic Section Index Template

Used for non-chronological section landing pages.
Falls back when no specialized template exists.

Context variables:
- section: Section object (for auto-generated pages)
- page: Page object (for explicit _index.md files)
- posts: Child pages (_posts)
- subsections: Child sections (_subsections)

Frontmatter options:
- show_children: true/false (default: true)
- children_title: "In This Section" or false (default: none)
- show_related: true/false/number (default: false)
- children_variant: compact/cards/minimal (default: compact)
#}

{% from 'partials/navigation-components.html' import breadcrumbs %}
{% from 'partials/content-components.html' import content_tiles %}

{% block content %}
{{ breadcrumbs(page if page is defined else section) }}

<div class="section-index">
    <header class="section-header">
        <h1>{{ page.title if (page is defined and page) else section.title if section else site.config.title }}</h1>

        {% if (page is defined and page) and page.metadata.get('description', '') %}
        <p class="section-description">{{ page.metadata.get('description', '') }}</p>
        {% elif section and section.metadata.get('description') %}
        <p class="section-description">{{ section.metadata.get('description', '') }}</p>
        {% endif %}
    </header>

    {# User-provided content (from _index.md) #}
    {% if content %}
    <div class="section-content prose">
        {{ content | safe }}
    </div>
    {% endif %}

    {# Child content display - can be disabled via frontmatter: show_children: false #}
    {% set show_children = page.metadata.get('show_children', true) if (page is defined and page) else true %}
    {% if show_children %}
    {# Get frontmatter options #}
    {% set children_title = page.metadata.get('children_title', none) if (page is defined and page) else none %}
    {% set show_related = page.metadata.get('show_related', false) if (page is defined and page) else false %}
    {% set related_limit = show_related if show_related is number else 5 %}
    {% set children_variant = page.metadata.get('children_variant', 'compact') if (page is defined and page) else
    'compact' %}

    {{ content_tiles(
    title=children_title,
    children=posts,
    subsections=subsections,
    related=show_related,
    related_limit=related_limit,
    variant=children_variant,
    group_by='type' if show_related else none
    ) }}
    {% endif %}

    {# Empty state if no children to display #}
    {% if not (posts or subsections) %}
    {# Empty state with helpful guidance #}
    <div class="section-empty">
        <div class="empty-state">
            <p class="empty-message">This section doesn't have any content yet.</p>
            {% if section %}
            <div class="empty-help">
                <p><strong>To add content:</strong></p>
                <ul>
                    <li>Create a page: <code>content/{{ section.path.relative_to(site.content_dir) }}/my-page.md</code>
                    </li>
                    <li>Add a custom index:
                        <code>content/{{ section.path.relative_to(site.content_dir) }}/_index.md</code>
                    </li>
                    <li>Create a subsection:
                        <code>content/{{ section.path.relative_to(site.content_dir) }}/subsection/</code>
                    </li>
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}