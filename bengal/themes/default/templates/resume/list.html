{% extends "base.html" %}

{% block content %}
{# Load resume data from site.data (preferred) or params (fallback) #}
{# Use safe_access filter for clean dot-notation access without .get() everywhere #}
{% set resume = (site.data.resume if site.data and site.data.resume else params) | safe_access %}

<div class="resume">
    {# Header Section #}
    <header class="resume-header">
        <h1 class="resume-name">{{ resume.name or page.title }}</h1>
        {% if resume.headline %}
        <p class="resume-headline">{{ resume.headline }}</p>
        {% endif %}

        {# Contact Information #}
        {% if resume.contact %}
        {% set contact = resume.contact %}
        <div class="resume-contact">
            {% if contact.email %}
            <a href="mailto:{{ contact.email }}" class="contact-item">
                <span class="contact-icon">‚úâ</span> {{ contact.email }}
            </a>
            {% endif %}
            {% if contact.phone %}
            <span class="contact-item">
                <span class="contact-icon">üì±</span> {{ contact.phone }}
            </span>
            {% endif %}
            {% if contact.location %}
            <span class="contact-item">
                <span class="contact-icon">üìç</span> {{ contact.location }}
            </span>
            {% endif %}
            {% if contact.website %}
            <a href="{{ contact.website }}" class="contact-item" target="_blank">
                <span class="contact-icon">üåê</span> {{ contact.website | replace('https://', '') | replace('http://', '') }}
            </a>
            {% endif %}
            {% if contact.linkedin %}
            <a href="{{ contact.linkedin }}" class="contact-item" target="_blank">
                <span class="contact-icon">üíº</span> LinkedIn
            </a>
            {% endif %}
            {% if contact.github %}
            <a href="{{ contact.github }}" class="contact-item" target="_blank">
                <span class="contact-icon">üîó</span> GitHub
            </a>
            {% endif %}
        </div>
        {% endif %}
    </header>

    {# Summary/About Section #}
    {% if resume.summary or content %}
    <section class="resume-section resume-summary">
        {% if resume.summary %}
        <p class="summary-text">{{ resume.summary }}</p>
        {% endif %}
        {% if content %}
        <div class="summary-content prose">
            {{ content | safe }}
        </div>
        {% endif %}
    </section>
    {% endif %}

    {# Experience Section #}
    {% if resume.experience %}
    <section class="resume-section">
        <h2 class="section-title">Experience</h2>
        <div class="timeline">
            {% for job in resume.experience %}
            {% set job = job | safe_access %}
            <div class="timeline-item">
                <div class="timeline-header">
                    <div class="timeline-title-group">
                        <h3 class="timeline-title">{{ job.title }}</h3>
                        <p class="timeline-company">{{ job.company }}</p>
                    </div>
                    <div class="timeline-meta">
                        <span class="timeline-date">{{ job.start_date }} - {{ job.end_date or 'Present' }}</span>
                        {% if job.location %}
                        <span class="timeline-location">{{ job.location }}</span>
                        {% endif %}
                    </div>
                </div>
                {% if job.description %}
                <p class="timeline-description">{{ job.description }}</p>
                {% endif %}
                {% if job.highlights and job.highlights is iterable and job.highlights is not string %}
                <ul class="timeline-highlights">
                    {% for highlight in job.highlights %}
                    <li>{{ highlight }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if job.technologies and job.technologies is iterable and job.technologies is not string %}
                <div class="timeline-technologies">
                    <strong>Technologies:</strong>
                    {% for tech in job.technologies %}
                    <span class="tech-tag">{{ tech }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Education Section #}
    {% if resume.education %}
    <section class="resume-section">
        <h2 class="section-title">Education</h2>
        <div class="timeline">
            {% for edu in resume.education %}
            {% set edu = edu | safe_access %}
            <div class="timeline-item">
                <div class="timeline-header">
                    <div class="timeline-title-group">
                        <h3 class="timeline-title">{{ edu.degree }}</h3>
                        <p class="timeline-company">{{ edu.institution }}</p>
                    </div>
                    <div class="timeline-meta">
                        <span class="timeline-date">{{ edu.start_date }} - {{ edu.end_date or 'Present' }}</span>
                        {% if edu.location %}
                        <span class="timeline-location">{{ edu.location }}</span>
                        {% endif %}
                    </div>
                </div>
                {% if edu.gpa %}
                <p class="timeline-description">GPA: {{ edu.gpa }}</p>
                {% endif %}
                {% if edu.honors %}
                <ul class="timeline-highlights">
                    {% for honor in edu.honors %}
                    <li>{{ honor }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if edu.coursework %}
                <div class="timeline-technologies">
                    <strong>Relevant Coursework:</strong> {{ edu.coursework | join(', ') }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Skills Section #}
    {% if resume.skills %}
    <section class="resume-section">
        <h2 class="section-title">Skills</h2>
        <div class="skills-grid">
            {% for skill_group in resume.skills %}
            {% set skill_group = skill_group | safe_access %}
            <div class="skill-group">
                <h3 class="skill-category">{{ skill_group.category }}</h3>
                <div class="skill-tags">
                    {% for skill in skill_group.items %}
                    <span class="skill-tag">{{ skill }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Projects Section #}
    {% if resume.projects %}
    <section class="resume-section">
        <h2 class="section-title">Projects</h2>
        <div class="timeline">
            {% for project in resume.projects %}
            {% set project = project | safe_access %}
            <div class="timeline-item">
                <div class="timeline-header">
                    <div class="timeline-title-group">
                        <h3 class="timeline-title">
                            {% if project.url %}
                            <a href="{{ project.url }}" target="_blank">{{ project.name }}</a>
                            {% else %}
                            {{ project.name }}
                            {% endif %}
                        </h3>
                        {% if project.role %}
                        <p class="timeline-company">{{ project.role }}</p>
                        {% endif %}
                    </div>
                    {% if project.date %}
                    <div class="timeline-meta">
                        <span class="timeline-date">{{ project.date }}</span>
                    </div>
                    {% endif %}
                </div>
                {% if project.description %}
                <p class="timeline-description">{{ project.description }}</p>
                {% endif %}
                {% if project.highlights %}
                <ul class="timeline-highlights">
                    {% for highlight in project.highlights %}
                    <li>{{ highlight }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if project.technologies %}
                <div class="timeline-technologies">
                    <strong>Technologies:</strong>
                    {% for tech in project.technologies %}
                    <span class="tech-tag">{{ tech }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if project.github or project.demo %}
                <div class="project-links">
                    {% if project.github %}
                    <a href="{{ project.github }}" target="_blank" class="project-link">GitHub</a>
                    {% endif %}
                    {% if project.demo %}
                    <a href="{{ project.demo }}" target="_blank" class="project-link">Live Demo</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Certifications Section #}
    {% if resume.certifications %}
    <section class="resume-section">
        <h2 class="section-title">Certifications</h2>
        <div class="certifications-list">
            {% for cert in resume.certifications %}
            {% set cert = cert | safe_access %}
            <div class="certification-item">
                <h3 class="certification-name">{{ cert.name }}</h3>
                <p class="certification-issuer">{{ cert.issuer }}</p>
                {% if cert.date %}
                <p class="certification-date">{{ cert.date }}</p>
                {% endif %}
                {% if cert.url %}
                <a href="{{ cert.url }}" target="_blank" class="certification-link">View Credential ‚Üí</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Awards Section #}
    {% if resume.awards %}
    <section class="resume-section">
        <h2 class="section-title">Awards & Recognition</h2>
        <div class="awards-list">
            {% for award in resume.awards %}
            {% set award = award | safe_access %}
            <div class="award-item">
                <h3 class="award-name">{{ award.name }}</h3>
                <p class="award-issuer">{{ award.issuer }}</p>
                {% if award.date %}
                <p class="award-date">{{ award.date }}</p>
                {% endif %}
                {% if award.description %}
                <p class="award-description">{{ award.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Languages Section #}
    {% if resume.languages %}
    <section class="resume-section">
        <h2 class="section-title">Languages</h2>
        <div class="languages-list">
            {% for lang in resume.languages %}
            {% set lang = lang | safe_access %}
            <div class="language-item">
                <span class="language-name">{{ lang.language }}</span>
                <span class="language-level">{{ lang.proficiency }}</span>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Volunteer Section #}
    {% if resume.volunteer %}
    <section class="resume-section">
        <h2 class="section-title">Volunteer Experience</h2>
        <div class="timeline">
            {% for vol in resume.volunteer %}
            {% set vol = vol | safe_access %}
            <div class="timeline-item">
                <div class="timeline-header">
                    <div class="timeline-title-group">
                        <h3 class="timeline-title">{{ vol.role }}</h3>
                        <p class="timeline-company">{{ vol.organization }}</p>
                    </div>
                    <div class="timeline-meta">
                        <span class="timeline-date">{{ vol.start_date }} - {{ vol.end_date or 'Present' }}</span>
                    </div>
                </div>
                {% if vol.description %}
                <p class="timeline-description">{{ vol.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {# Page Content (bio, personal statement, etc.) #}
    {% if content and content.strip() %}
    <section class="resume-section resume-custom-content prose">
        {{ content | safe }}
    </section>
    {% endif %}
</div>
{% endblock %}
