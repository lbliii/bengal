{#
Bengal OpenAPI List Page
========================

Consolidated endpoint list for a tag/category section.
Groups multiple endpoints under a single tag with method badges.

Context:
- element: DocElement (optional, for tag info)
- section: Section containing endpoints
- page: Page object
- site: Site instance
- config: Config instance

Kida Features:
- {% with %} for nil-resilient optional sections
- {% spaceless %} for compact badge output
- Optional chaining (?.) and null coalescing (??)
#}
{% extends 'autodoc/openapi/layouts/reference.html' %}

{% let tag_name = element?.name ?? section?.title ?? page?.title ?? 'Endpoints' %}
{% let tag_desc = element?.description ?? section?.metadata?.description ?? '' %}
{% let endpoints = section?.pages ?? [] %}

{% block header %}
<h1 class="api-list__title">{{ tag_name }}</h1>

{% if tag_desc %}
<div class="api-list__description prose">
  {{ tag_desc | markdownify | safe }}
</div>
{% end %}

<div class="api-list__stats">
  <span class="badge badge--outline">{{ endpoints | length }} endpoints</span>
</div>
{% end %}

{% block content_main %}
<div class="api-list" data-autodoc="openapi" data-element="list">

  {# Endpoint Table #}
  {% if endpoints | length > 0 %}
  <section class="api-list__endpoints autodoc-section">
    <table class="autodoc-table" data-table="endpoints">
      <thead>
        <tr>
          <th>Method</th>
          <th>Endpoint</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for ep_page in endpoints %}
        {% if ep_page != section?.index_page %}
        {% let ep_meta = ep_page?.metadata ?? {} %}
        {% let ep_method = ep_meta?.method ?? 'GET' %}
        {% let ep_path = ep_meta?.path ?? ep_page?.title ?? '' %}
        {% let ep_summary = ep_meta?.summary ?? '' %}
        {% let is_deprecated = ep_meta?.deprecated ?? false %}

        <tr class="{% if is_deprecated %}api-list__row--deprecated{% end %}">
          <td class="autodoc-cell-name" data-label="Method">
            {% spaceless %}
            <span class="api-method api-method--sm api-method--{{ ep_method |> lower }}">{{ ep_method }}</span>
            {% end %}
          </td>
          <td class="autodoc-cell-name" data-label="Endpoint">
            <a href="{{ ep_page?.href ?? '#' }}">
              <code>{{ ep_path }}</code>
              {% if is_deprecated %}
              <span class="autodoc-badge" data-badge="deprecated">Deprecated</span>
              {% end %}
            </a>
          </td>
          <td class="autodoc-cell-desc" data-label="Description">
            {{ ep_summary | truncate(100) }}
          </td>
        </tr>
        {% end %}
        {% end %}
      </tbody>
    </table>
  </section>
  {% else %}
  {# Empty State #}
  <div class="autodoc-empty-state">
    {{ icon('inbox', size=48, class='autodoc-empty-state-icon') }}
    <p class="autodoc-empty-state-text">No endpoints in this category</p>
  </div>
  {% end %}

  {# Cards View (Alternative) #}
  {% if endpoints | length > 0 %}
  <section class="api-list__cards autodoc-section">
    <h2 class="autodoc-section-title">Quick Reference</h2>
    <div class="autodoc-cards">
      {% for ep_page in endpoints %}
      {% if ep_page != section?.index_page %}
      {% let ep_meta = ep_page?.metadata ?? {} %}
      {% let ep_method = ep_meta?.method ?? 'GET' %}
      {% let ep_path = ep_meta?.path ?? ep_page?.title ?? '' %}
      {% let ep_summary = ep_meta?.summary ?? '' %}
      {% let is_deprecated = ep_meta?.deprecated ?? false %}

      <a href="{{ ep_page?.href ?? '#' }}" class="autodoc-card{% if is_deprecated %} autodoc-card--deprecated{% end %}">
        <div class="autodoc-card-header">
          {% spaceless %}
          <span class="api-method api-method--sm api-method--{{ ep_method |> lower }}">{{ ep_method }}</span>
          {% end %}
          <code class="autodoc-card-name">{{ ep_path }}</code>
        </div>
        {% if ep_summary %}
        <p class="autodoc-card-desc">{{ ep_summary | truncate(80) }}</p>
        {% end %}
        {% if is_deprecated %}
        <span class="autodoc-badge" data-badge="deprecated">Deprecated</span>
        {% end %}
      </a>
      {% end %}
      {% end %}
    </div>
  </section>
  {% end %}
</div>
{% end %}
