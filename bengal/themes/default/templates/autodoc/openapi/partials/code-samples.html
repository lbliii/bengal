{#
  Bengal OpenAPI Code Samples

  Language-switched code sample panels.

  Supports: curl, Python, JavaScript, Go, Ruby, PHP

  Context:
    - element: DocElement with OpenAPIEndpointMetadata
    - element.typed_metadata: OpenAPIEndpointMetadata
    - base_url: str (API base URL)
#}
{% let meta = element.typed_metadata %}
{% let method = meta?.method ?? 'GET' %}
{% let path = meta?.path ?? '/' %}
{% let base = base_url ?? 'https://api.example.com' %}

{# Available languages #}
{% let languages = ['curl', 'python', 'javascript', 'go', 'ruby', 'php'] %}

<div class="api-code-samples">
  <header class="api-code-samples__header">
    <h4 class="api-code-samples__title">Request</h4>

    {# Language Tabs #}
    <div class="api-code-samples__tabs" role="tablist">
      {% for lang in languages %}
      <button
        class="api-code-samples__tab {{ 'api-code-samples__tab--active' if loop.first else '' }}"
        role="tab"
        aria-selected="{{ 'true' if loop.first else 'false' }}"
        aria-controls="code-panel-{{ lang }}"
        id="code-tab-{{ lang }}"
        data-lang="{{ lang }}"
      >
        {{ lang | title }}
      </button>
      {% end %}
    </div>
  </header>

  {# Code Panels #}
  <div class="api-code-samples__panels">
    {% for lang in languages %}
    <div
      class="api-code-samples__panel {{ 'api-code-samples__panel--active' if loop.first else '' }}"
      role="tabpanel"
      id="code-panel-{{ lang }}"
      aria-labelledby="code-tab-{{ lang }}"
      {{ 'hidden' if not loop.first else '' }}
    >
      <div class="api-code-samples__code">
        {# Copy Button #}
        <button
          class="api-code-samples__copy"
          type="button"
          data-copy-target="code-{{ lang }}"
          aria-label="Copy {{ lang }} code"
        >
          <svg class="icon" aria-hidden="true" width="14" height="14">
            <use href="#icon-copy"></use>
          </svg>
        </button>

        {# Code Block - Generated by template function #}
        <pre id="code-{{ lang }}"><code class="language-{{ lang }}">{{ generate_code_sample(element, lang, base) }}</code></pre>
      </div>
    </div>
    {% end %}
  </div>

  {# Response Example (if available) #}
  {% with meta?.responses as responses %}
    {% if responses %}
      {% let success_response = responses | selectattr('status_code', 'startswith', '2') | first %}
      {% if success_response and success_response.schema_ref %}
      <div class="api-code-samples__response">
        <header class="api-code-samples__response-header">
          <h4 class="api-code-samples__title">Response</h4>
          <span class="badge badge--success">{{ success_response.status_code }}</span>
        </header>
        <pre><code class="language-json">{{ get_response_example(success_response) | tojson(indent=2) }}</code></pre>
      </div>
      {% end %}
    {% end %}
  {% end %}
</div>
