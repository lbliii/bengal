{% extends "base.html" %}

{#
================================================================================
OpenAPI Reference Schema Template (Kida-Enhanced)
================================================================================

Renders an OpenAPI schema's documentation using the autodoc skeleton.
Uses Kida's advanced templating features for robust rendering.

This template receives:
- element: DocElement for the schema
- config: Autodoc configuration
- site: Site instance
================================================================================
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation, toc %}

{# Cache schema metadata #}
{% let
  meta = element.metadata,
  schema_type = meta.type ?? 'object',
  properties = meta.properties ?? {},
  required_props = meta.required ?? [],
  example = meta.example,
  enum_values = meta.enum ?? []
%}

{% block content %}
{# Three-column documentation layout #}
<div class="docs-layout">
  {# Left Sidebar: Navigation #}
  <aside class="docs-sidebar" id="docs-sidebar" role="navigation" aria-label="API navigation">
    {% include 'partials/docs-nav.html' %}
  </aside>

  {# Main Content #}
  <div class="docs-main">
    {# Page Hero: Breadcrumbs + Title + Description + Metadata #}
    {% include 'partials/page-hero.html' %}

    {# Article Content - autodoc skeleton #}
    <article data-autodoc data-type="openapi" data-element="schema" class="autodoc docs-content">

      {# Header #}
      <header class="autodoc-header">
        <div class="autodoc-badges">
          <span class="autodoc-badge" data-badge="schema">Schema</span>
          <span class="autodoc-badge" data-badge="openapi">OpenAPI</span>
        </div>

        <h1 class="autodoc-title">
          <code>{{ element.name }}</code>
        </h1>

        {% if element.description %}
        <div class="autodoc-description prose">
          {{ element.description | markdownify | safe }}
        </div>
        {% end %}
      </header>

      {# Schema Meta Stats #}
      <div class="autodoc-stats">
        <span class="autodoc-stat">
          <span class="autodoc-stat-label">Base Type:</span>
          <span class="autodoc-stat-value"><code>{{ schema_type }}</code></span>
        </span>
        {% if enum_values | length > 0 %}
        <span class="autodoc-stat">
          <span class="autodoc-stat-label">Enum:</span>
          <span class="autodoc-stat-value"><code>{{ enum_values | join(', ') }}</code></span>
        </span>
        {% end %}
      </div>

      {# Properties #}
      {% if properties | length > 0 %}
      <section class="autodoc-section" data-section="properties">
        <h2 class="autodoc-section-title">Properties</h2>
        <table class="autodoc-table" data-table="properties">
          <thead>
            <tr>
              <th>Property</th>
              <th>Type</th>
              <th>Required</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {% for prop_name, prop_schema in properties.items() %}
            {% let is_required = prop_name in required_props %}
            <tr {{ 'data-required="true"' | safe if is_required else '' }}>
              <td class="autodoc-cell-name">
                <code>{{ prop_name }}</code>
                {% if is_required %}
                <span class="autodoc-required-star" title="Required">*</span>
                {% end %}
              </td>
              <td class="autodoc-cell-type">
                <code>{{ prop_schema.type ?? 'object' }}</code>
                {% if prop_schema.format %}
                <small class="autodoc-format">({{ prop_schema.format }})</small>
                {% end %}
              </td>
              <td class="autodoc-cell-required">
                {% if is_required %}
                <span class="autodoc-badge" data-badge="required">Required</span>
                {% else %}
                <span class="autodoc-badge" data-badge="optional">Optional</span>
                {% end %}
              </td>
              <td class="autodoc-cell-desc">
                {% if prop_schema.description %}
                {{ prop_schema.description | markdownify | safe }}
                {% else %}
                <span class="table-empty">â€”</span>
                {% end %}

                {% if prop_schema.enum %}
                <div class="autodoc-prop-enum">
                  <strong>Enum:</strong> <code>{{ prop_schema.enum | join(' | ') }}</code>
                </div>
                {% end %}
              </td>
            </tr>
            {% end %}
          </tbody>
        </table>
      </section>
      {% end %}

      {# Example #}
      {% if example %}
      <section class="autodoc-section" data-section="examples">
        <h2 class="autodoc-section-title">Example</h2>
        <div class="autodoc-example">
          <header class="autodoc-example-header">
            <h4 class="autodoc-example-title">JSON Representation</h4>
            <span class="autodoc-example-lang">json</span>
          </header>
          <div class="autodoc-example-body">
            <pre><code class="language-json">{{ example | tojson(indent=2) }}</code></pre>
          </div>
        </div>
      </section>
      {% end %}

      {# Tags #}
      {% if page.tags %}
      <footer class="docs-footer">
        <span class="docs-footer-label">Tagged</span>
        {% from 'partials/components/tags.html' import tag_list %}
        {{ tag_list(page.tags) }}
      </footer>
      {% end %}
    </article>

    {# Page navigation (prev/next) at bottom #}
    {{ page_navigation(page) }}
  </div>

  {# Right Sidebar: Contextual Graph + TOC + Metadata #}
  {% include 'partials/docs-toc-sidebar.html' %}
</div>

{# Mobile sidebar toggle button #}
<button class="docs-sidebar-toggle" aria-label="Toggle navigation sidebar" aria-expanded="false"
  aria-controls="docs-sidebar">
  {{ icon('list', size=20) }}
</button>

{# Sidebar overlay for mobile #}
<div class="docs-sidebar-overlay" aria-hidden="true"></div>
{% end %}
