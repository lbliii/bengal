{#
  Bengal OpenAPI Endpoint Page - The Hero Template

  Full endpoint documentation with parameters, request body, responses, and code samples.
  Uses the three-column explorer layout.

  Context:
    - element: DocElement with OpenAPIEndpointMetadata
    - element.typed_metadata: OpenAPIEndpointMetadata
    - schemas: dict (resolved schemas from spec)
    - base_url: str (API base URL)
    - api_spec: OpenAPIOverviewMetadata
    - endpoints: list[DocElement] (all endpoints for nav)
    - site: Site
    - config: Config
#}
{% extends 'autodoc/openapi/layouts/explorer.html' %}

{% let meta = element.typed_metadata %}
{% let method = meta?.method ?? 'GET' %}
{% let path = meta?.path ?? '/' %}
{% let parameters = meta?.parameters ?? () %}
{% let request_body = meta?.request_body %}
{% let responses = meta?.responses ?? () %}

{# Group parameters by location #}
{% let path_params = parameters | selectattr('location', 'eq', 'path') | list %}
{% let query_params = parameters | selectattr('location', 'eq', 'query') | list %}
{% let header_params = parameters | selectattr('location', 'eq', 'header') | list %}
{% let cookie_params = parameters | selectattr('location', 'eq', 'cookie') | list %}

{% block content %}
<article class="api-endpoint" data-method="{{ method | lower }}">
  {# Playground Bar: Method + Path + Copy #}
  {% include 'autodoc/openapi/partials/playground-bar.html' %}

  {# Endpoint Header: Title, Description, Badges #}
  {% include 'autodoc/openapi/partials/endpoint-header.html' %}

  {# Parameters Section #}
  {% if parameters %}
  <section class="api-endpoint__section api-endpoint__parameters">
    <h2 class="api-endpoint__section-title">Parameters</h2>

    {# Path Parameters #}
    {% if path_params %}
    <div class="api-endpoint__param-group">
      <h3 class="api-endpoint__param-group-title">
        Path Parameters
        <span class="badge badge--info-subtle badge--xs">{{ path_params | length }}</span>
      </h3>
      <div class="api-endpoint__param-list">
        {% for param in path_params %}
          {% include 'autodoc/openapi/partials/param-row.html' with param=param %}
        {% end %}
      </div>
    </div>
    {% end %}

    {# Query Parameters #}
    {% if query_params %}
    <div class="api-endpoint__param-group">
      <h3 class="api-endpoint__param-group-title">
        Query Parameters
        <span class="badge badge--secondary-subtle badge--xs">{{ query_params | length }}</span>
      </h3>
      <div class="api-endpoint__param-list">
        {% for param in query_params %}
          {% include 'autodoc/openapi/partials/param-row.html' with param=param %}
        {% end %}
      </div>
    </div>
    {% end %}

    {# Header Parameters #}
    {% if header_params %}
    <div class="api-endpoint__param-group">
      <h3 class="api-endpoint__param-group-title">
        Header Parameters
        <span class="badge badge--warning-subtle badge--xs">{{ header_params | length }}</span>
      </h3>
      <div class="api-endpoint__param-list">
        {% for param in header_params %}
          {% include 'autodoc/openapi/partials/param-row.html' with param=param %}
        {% end %}
      </div>
    </div>
    {% end %}

    {# Cookie Parameters #}
    {% if cookie_params %}
    <div class="api-endpoint__param-group">
      <h3 class="api-endpoint__param-group-title">
        Cookie Parameters
        <span class="badge badge--accent-subtle badge--xs">{{ cookie_params | length }}</span>
      </h3>
      <div class="api-endpoint__param-list">
        {% for param in cookie_params %}
          {% include 'autodoc/openapi/partials/param-row.html' with param=param %}
        {% end %}
      </div>
    </div>
    {% end %}
  </section>
  {% end %}

  {# Request Body Section #}
  {% with request_body as body %}
    {% if body %}
    <section class="api-endpoint__section api-endpoint__request-body">
      {% include 'autodoc/openapi/partials/request-body.html' with body=body, schemas=schemas %}
    </section>
    {% end %}
  {% end %}

  {# Responses Section #}
  {% if responses %}
  <section class="api-endpoint__section api-endpoint__responses">
    {% include 'autodoc/openapi/partials/responses.html' with responses=responses, schemas=schemas %}
  </section>
  {% end %}
</article>
{% end %}

{% block code %}
{# Code Samples Panel (right sidebar in explorer layout) #}
{% include 'autodoc/openapi/partials/code-samples.html' with element=element, base_url=base_url %}
{% end %}
