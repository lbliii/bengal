{#
Autodoc Cards Partial

Renders a card grid for child elements (subcommands, classes, functions, endpoints).

Required: children (list of DocElements)
Optional: title (str), card_type (str), url_prefix (str)

Also provides element_card macro for individual cards.
#}

{% macro element_card(child, card_type=none, url_prefix=none) %}
{% set child_type = card_type or child.element_type %}
{# Build URL based on element type - match project patterns #}
{% if child.url %}
  {% set child_url = child.url %}
{% elif child_type in ['command', 'command-group'] %}
  {% set child_url = '/cli/' ~ (child.qualified_name | replace('.', '/')) ~ '/' %}
{% elif child_type in ['class', 'function', 'module'] %}
  {% set child_url = '/api/' ~ (child.qualified_name | replace('.', '/')) ~ '/' %}
{% elif url_prefix %}
  {% set child_url = url_prefix ~ (child.qualified_name | replace('.', '/')) ~ '/' %}
{% else %}
  {% set child_url = '#' %}
{% endif %}
<a href="{{ child_url }}" class="autodoc-card" data-card="{{ child_type }}">
  {% if child_type == 'endpoint' and child.metadata.method %}
  <span class="autodoc-method" data-method="{{ child.metadata.method | lower }}">{{ child.metadata.method | upper }}</span>
  {% endif %}
  <code class="autodoc-card-name">{{ child.name }}</code>
  {% if child.description %}
  <span class="autodoc-card-desc">{{ child.description | truncate(100) }}</span>
  {% endif %}
</a>
{% endmacro %}

{# Main template body - only executes when included directly (not when importing macros) #}
{# Guard with 'is defined' check since this runs even during {% from ... import ... %} #}
{% if children is defined and children %}
{% set title = title | default('') %}
{% set card_type = card_type | default(none) %}

{% if title %}
<section class="autodoc-section" data-section="children">
  <h2 class="autodoc-section-title">{{ title }}</h2>
{% endif %}

  <div class="autodoc-cards">
    {% for child in children %}
    {{ element_card(child, card_type) }}
    {% endfor %}
  </div>

{% if title %}
</section>
{% endif %}
{% endif %}
