{#
Autodoc Parameters Table Partial

Renders parameters/options/arguments as a table.
Works with CLI DocElements, OpenAPI raw dicts, and Python args.

Required: params (list of DocElements or dicts)
Optional: title (str), param_type (str: 'option', 'argument', 'parameter')

Supports:
- CLI DocElements: param.metadata.type, param.description
- OpenAPI dicts: param.schema.type, param.description
- Python args: param.type, param.docstring
#}

{% set title = title | default('Parameters') %}
{% set param_type = param_type | default('parameter') %}

{% if params %}
<section class="autodoc-section" data-section="parameters">
  <h2 class="autodoc-section-title">{{ title }}</h2>

  <table class="autodoc-table" data-table="parameters">
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Default</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {% for param in params %}
      {# ChainableUndefined handles both DocElements and raw dicts #}
      {% set meta = param.metadata %}

      {# Required: check metadata first, then param directly #}
      {% set is_required = meta.required | default(param.required) %}

      {# Name: CLI opts array, or direct name #}
      {% set param_name = meta.opts | join(', ') if meta.opts else param.name %}

      {# Type: CLI meta.type, OpenAPI schema.type, or Python type #}
      {% set schema = param.schema %}
      {% set param_type_val = meta.type | default(schema.type) | default(param.type) %}

      {# Default: CLI meta.default, OpenAPI schema.default, or Python default #}
      {% set param_default = meta.default | default(schema.default) | default(param.default) %}

      {# Description: DocElement.description, dict.description, or dict.docstring #}
      {% set param_desc = param.description or param.docstring or meta.docstring or '—' %}

      <tr data-required="{{ 'true' if is_required else 'false' }}">
        <td class="autodoc-cell-name" data-label="Name"><code>{{ param_name }}</code></td>
        <td class="autodoc-cell-type" data-label="Type"><code>{{ param_type_val or '—' }}</code></td>
        <td class="autodoc-cell-default" data-label="Default">
          {%- if param_default -%}
          <code>{{ param_default }}</code>
          {%- else -%}
          <span class="table-empty">—</span>
          {% end %}
        </td>
        <td class="autodoc-cell-desc" data-label="Description">{{ param_desc | markdownify | safe }}</td>
      </tr>
      {% end %}
    </tbody>
  </table>
</section>
{% end %}
