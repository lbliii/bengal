{#
================================================================================
REST API Documentation Navigation (Kida-Native)
================================================================================

Specialized sidebar navigation for REST API documentation.
Provides deep-linking to specific endpoints within consolidated pages.

KIDA FEATURES USED:
- {% let %} for scoped caching
- Pipeline operators for metadata transformation
- Optional chaining for safe metadata access
================================================================================
#}

<nav class="docs-nav docs-nav--rest" aria-label="API navigation">
  {# 1. Back to API Hub #}
  {% let api_root = section.root %}
  <div class="docs-nav-back">
    <a href="{{ api_root.href | absolute_url }}" class="docs-nav-back-link">
      {{ icon('arrow-left', size=14) }} <span>All API Reference</span>
    </a>
  </div>

  {# 2. Section Header (The Tag/Resource) #}
  <div class="docs-nav-group docs-nav-group--root expanded">
    <div class="docs-nav-group-header">
      <span class="docs-nav-icon">{{ icon('book-open', size=16) }}</span>
      <span class="docs-nav-group-title">{{ section.title }}</span>
    </div>

    {# 3. Endpoint List #}
    <div class="docs-nav-group-items expanded">
      {% for element in section.params.endpoints %}
        {% let
          method = element.metadata.method | upper,
          path = element.metadata.path,
          summary = element.metadata.summary ?? element.description,
          operation_id = element.metadata.operation_id,
          target_id = operation_id or (method|lower ~ '-' ~ path|slugify)
        %}
        <div class="docs-nav-rest-item" data-method="{{ method | lower }}">
          <a href="#{{ target_id }}" class="docs-nav-rest-link">
            <span class="docs-nav-rest-method" data-method="{{ method | lower }}">{{ method }}</span>
            <span class="docs-nav-rest-path" title="{{ path }}">{{ path }}</span>
          </a>
        </div>
      {% end %}
    </div>
  </div>

  {# 4. Sibling Resources (Other tags in this spec) #}
  {% let siblings = section.parent.subsections ?? [] %}
  {% if siblings | length > 1 %}
  <div class="docs-nav-group">
    <div class="docs-nav-group-header docs-nav-sub-header">
      <span class="docs-nav-group-title">Resources</span>
    </div>
    <div class="docs-nav-group-items expanded">
      {% for sib in siblings %}
        {% if sib != section %}
        <div class="docs-nav-group-leaf">
          <a href="{{ sib.href | absolute_url }}" class="docs-nav-link">
            <span class="docs-nav-icon">{{ icon('folder', size=14) }}</span>
            <span class="docs-nav-link-text">{{ sib.title }}</span>
          </a>
        </div>
        {% end %}
      {% end %}
    </div>
  </div>
  {% end %}
</nav>

<style>
.docs-nav--rest {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.docs-nav-back {
  margin-bottom: var(--space-2);
}

.docs-nav-back-link {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: var(--weight-bold);
}

.docs-nav-back-link:hover {
  color: var(--color-primary);
}

.docs-nav-rest-item {
  position: relative;
  margin-block: 2px;
}

.docs-nav-rest-link {
  display: flex;
  align-items: baseline;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  text-decoration: none;
  border-radius: var(--radius-sm);
  transition: background var(--transition-base);
}

.docs-nav-rest-link:hover {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.docs-nav-rest-method {
  font-family: var(--font-mono);
  font-weight: var(--weight-bold);
  min-width: 35px;
  text-align: right;
  font-size: 10px;
}

.docs-nav-rest-method[data-method="get"] { color: var(--color-success); }
.docs-nav-rest-method[data-method="post"] { color: var(--blue-500); }
.docs-nav-rest-method[data-method="put"] { color: var(--orange-500); }
.docs-nav-rest-method[data-method="delete"] { color: var(--red-500); }
.docs-nav-rest-method[data-method="patch"] { color: var(--green-400); }

.docs-nav-rest-path {
  font-family: var(--font-mono);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.docs-nav-sub-header {
  margin-top: var(--space-4);
  opacity: 0.6;
}
</style>
