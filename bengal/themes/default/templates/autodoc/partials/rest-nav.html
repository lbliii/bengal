{#
================================================================================
REST API Documentation Navigation (Kida-Native)
================================================================================

Specialized sidebar navigation for REST API documentation.
Provides deep-linking to specific endpoints within consolidated pages.

KIDA FEATURES USED:
- {% let %} for scoped caching
- Pipeline operators for metadata transformation
- Optional chaining for safe metadata access
================================================================================
#}

<nav class="docs-nav docs-nav--rest" aria-label="API navigation">
  {# 1. Back to API Hub #}
  {% let api_root = section.root %}
  <div class="docs-nav-back">
    <a href="{{ api_root.href | absolute_url }}" class="docs-nav-back-link">
      {{ icon('arrow-left', size=14) }} <span>All API Reference</span>
    </a>
  </div>

  {# 2. Section Header (The Tag/Resource) #}
  <div class="docs-nav-group docs-nav-group--root expanded">
    <div class="docs-nav-group-header">
      <span class="docs-nav-icon">{{ icon('book-open', size=16) }}</span>
      <span class="docs-nav-group-title">{{ section.title }}</span>
    </div>

    {# 3. Endpoint List #}
    <div class="docs-nav-group-items expanded">
      {% for element in section.params.endpoints %}
        {% let
          method = element.metadata.method | upper,
          path = element.metadata.path,
          summary = element.metadata.summary ?? element.description,
          operation_id = element.metadata.operation_id,
          target_id = operation_id or (method|lower ~ '-' ~ path|slugify)
        %}
        <div class="docs-nav-rest-item" data-method="{{ method | lower }}">
          <a href="#{{ target_id }}" class="docs-nav-rest-link">
            <span class="docs-nav-rest-method" data-method="{{ method | lower }}">{{ method }}</span>
            <span class="docs-nav-rest-path" title="{{ summary or path }}">{{ summary or path | truncate(30) }}</span>
          </a>
        </div>
      {% end %}
    </div>
  </div>

  {# 4. Sibling Resources (Other tags in this spec) #}
  {% let siblings = section.parent.subsections ?? [] %}
  {% if siblings | length > 1 %}
  <div class="docs-nav-group">
    <div class="docs-nav-group-header docs-nav-sub-header">
      <span class="docs-nav-group-title">Resources</span>
    </div>
    <div class="docs-nav-group-items expanded">
      {% for sib in siblings %}
        {% if sib != section %}
        <div class="docs-nav-group-leaf">
          <a href="{{ sib.href | absolute_url }}" class="docs-nav-link">
            <span class="docs-nav-icon">{{ icon('folder', size=14) }}</span>
            <span class="docs-nav-link-text">{{ sib.title }}</span>
          </a>
        </div>
        {% end %}
      {% end %}
    </div>
  </div>
  {% end %}
</nav>
