{#
Autodoc Members Partial

Renders collapsible member cards for methods, attributes, etc.

Required: members (list of DocElements)
Optional: title (str), member_type (str), first_open (bool, default true)
#}

{% set title = title | default('Members') %}
{% set member_type = member_type | default('method') %}
{% set first_open = first_open | default(true) %}

{% if members %}
<section class="autodoc-section" data-section="{{ member_type }}s">
  <h2 class="autodoc-section-title">{{ title }}</h2>

  {% for member in members %}
  <details class="autodoc-member" data-member="{{ member_type }}" {% if first_open and loop.first %}open{% endif %}>
    <summary class="autodoc-member-header">
      <code class="autodoc-member-name">{{ member.name }}</code>
      {% if member.metadata.signature or member.signature %}
      <span class="autodoc-member-sig">{{ member.metadata.signature or member.signature }}</span>
      {% endif %}
      {% set member_badges = [] %}
      {% if member.metadata.is_async %}{% set _ = member_badges.append('async') %}{% endif %}
      {% if member.metadata.is_classmethod %}{% set _ = member_badges.append('classmethod') %}{% endif %}
      {% if member.metadata.is_staticmethod %}{% set _ = member_badges.append('staticmethod') %}{% endif %}
      {% if member.metadata.is_property %}{% set _ = member_badges.append('property') %}{% endif %}
      {% if member.metadata.is_abstract %}{% set _ = member_badges.append('abstract') %}{% endif %}
      {% if member.metadata.is_deprecated %}{% set _ = member_badges.append('deprecated') %}{% endif %}
      {% if member_badges %}
      <span class="autodoc-member-badges">
        {% for badge in member_badges %}
        <span class="autodoc-badge" data-badge="{{ badge }}">{{ badge }}</span>
        {% endfor %}
      </span>
      {% endif %}
    </summary>
    <div class="autodoc-member-body">
      {% if member.description %}
      <div class="autodoc-member-desc">
        <p>{{ member.description }}</p>
      </div>
      {% endif %}

      {# Member parameters #}
      {% set member_params = member.metadata.parameters | default(member.children | default([]) | selectattr('element_type', 'eq', 'parameter') | list) %}
      {% if member_params %}
      <dl class="autodoc-params">
        {% for param in member_params %}
        {% set param_name = param.name if param.name is defined else param.get('name', '') %}
        {% set param_type_val = param.type if param.type is defined else param.get('type', '') %}
        {% set param_desc = param.description if param.description is defined else param.get('description', '') %}
        <div class="autodoc-param">
          <dt class="autodoc-param-name">
            <code>{{ param_name }}</code>
            {% if param_type_val %}
            <span class="autodoc-param-type">{{ param_type_val }}</span>
            {% endif %}
          </dt>
          <dd class="autodoc-param-desc">{{ param_desc }}</dd>
        </div>
        {% endfor %}
      </dl>
      {% endif %}

      {# Member return type #}
      {% set member_return = member.metadata.return_type | default(member.metadata.returns | default('')) %}
      {% if member_return %}
      <div class="autodoc-returns">
        <code class="autodoc-returns-type">{{ member_return }}</code>
        {% if member.metadata.return_description %}
        <span class="autodoc-returns-desc">{{ member.metadata.return_description }}</span>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </details>
  {% endfor %}
</section>
{% endif %}
