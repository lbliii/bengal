{#
================================================================================
Tag Navigation Sidebar Component (Kida-Native)
================================================================================

Displays a list of all tags in the sidebar for tag browsing.

KIDA FEATURES USED:
- {% let %} for template-scoped variables
- Optional chaining (?.) for null-safe access
- Null coalescing (??) for smart defaults

CONTEXT:
- tags: List of tag objects with .name and .count (optional, falls back to popular_tags())
- current_tag: Current tag name when viewing a single tag page (optional)
================================================================================
#}

{# Resolve tag list: prefer context-provided tags, fall back to popular_tags() #}
{% if tags is defined %}
  {% let all_tags = tags %}
{% else %}
  {% let all_tags = popular_tags(limit=50) %}
{% end %}
{% let current_tag_normalized = (current_tag ?? '') | lower %}

<nav class="docs-nav" aria-label="Tags">
  <div class="docs-nav-tree">
    {# "All Tags" link â€” active when no specific tag is selected #}
    {% let is_all_tags = (current_tag ?? '') | length == 0 %}
    <a href="{{ '/tags/' | absolute_url }}"
      class="docs-nav-link{{ ' active' if is_all_tags else '' }}"
      {{ 'aria-current="page"' | safe if is_all_tags else '' }}>
      All Tags
    </a>

    {# Individual tag links #}
    {% if all_tags %}
    {% for tag_item in all_tags %}
    {% let tag_name = tag_item?.name ?? tag_item[0] ?? '' %}
    {% let tag_count = tag_item[1] ?? tag_item?.count ?? 0 %}
    {% let tag_name_normalized = tag_name | lower %}
    {% let is_active = current_tag_normalized == tag_name_normalized %}

    <a href="{{ tag_url(tag_name) }}"
      class="docs-nav-link{{ ' active' if is_active else '' }}"
      {{ 'aria-current="page"' | safe if is_active else '' }}>
      <span class="tag-nav-name">{{ tag_name }}</span>
      <span class="tag-nav-count">({{ tag_count }})</span>
    </a>
    {% end %}
    {% end %}
  </div>
</nav>
