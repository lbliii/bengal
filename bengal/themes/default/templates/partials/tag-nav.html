{#
================================================================================
Tag Navigation Sidebar Component (Kida-Native)
================================================================================

Displays a list of all tags in the sidebar.

KIDA FEATURES USED:
- {% let %} for template-scoped variables
- Optional chaining (?.) for null-safe access
- Null coalescing (??) for smart defaults

Variables:
- tags: List of tag objects with .name and .count (optional)
- current_tag: Current tag name if viewing a tag page (optional)
================================================================================
#}

{# Template-scoped variables #}
{# Cache popular tags - expensive operation that scans all pages #}
{% if tags %}
  {% let all_tags = tags %}
{% else %}
  {% cache 'popular-tags-50-' ~ (site.nav_version ?? ''), ttl='1h' %}
    {% let all_tags = popular_tags(limit=50) %}
  {% end %}
{% end %}
{% let current_tag_normalized = (current_tag ?? '') | lower %}

<nav class="docs-nav" aria-label="Tags">
  <div class="docs-nav-tree">
    {# Link to all tags page #}
    {% let is_all_tags = current_tag | length == 0 %}
    <a href="{{ '/tags/' | absolute_url }}" class="docs-nav-link{{ ' active' if is_all_tags else '' }}"
      {{ 'aria-current="page"' | safe if is_all_tags else '' }}>
      All Tags
    </a>

    {# List of tags #}
    {% if all_tags %}
    {% for tag_item in all_tags %}
    {# Handle both formats: objects with .name/.count OR tuples (name, count) #}
    {% let tag_name = tag_item?.name ?? tag_item[0] ?? '' %}
    {% let tag_count = tag_item?.count ?? tag_item[1] ?? 0 %}
    {% let tag_name_normalized = tag_name | lower %}
    {% let is_active = current_tag_normalized == tag_name_normalized %}

    <a href="{{ tag_url(tag_name) }}" class="docs-nav-link{{ ' active' if is_active else '' }}" {{ 'aria-current="page"'
      | safe if is_active else '' }}>
      <span class="tag-nav-name">{{ tag_name }}</span>
      <span class="tag-nav-count">({{ tag_count }})</span>
    </a>
    {% end %}
    {% end %}
  </div>
</nav>
