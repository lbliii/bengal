{#
Page Hero - Overview Variant

For section index pages (_index.md) - wayfinding focused:
- Breadcrumbs as eyebrow (trimmed, no current page)
- LLM share button aligned right
- Large H1 title tight below breadcrumbs
- Description
- Section stats (page count) instead of read time/word count

Usage: Included via page-hero.html dispatcher
Set hero_style: overview in frontmatter or auto-detected for list templates
#}

{% from 'partials/navigation-components.html' import breadcrumbs with context %}

{# Macro: Get page URL with fallback chain for robustness #}
{% macro get_page_url(page) -%}
    {{ page._path or page.href or '/' }}
{%- endmacro %}

{% if page %}
<div class="page-hero page-hero--overview">
  {# Top row: Breadcrumbs (left) + Actions (right) #}
  <div class="page-hero__top">
    {# Breadcrumbs as eyebrow - trimmed (excludes current page) #}
    <nav class="page-hero__eyebrow" aria-label="Breadcrumb">
      {% set breadcrumb_items = get_breadcrumbs(page) %}
      {% if breadcrumb_items and breadcrumb_items | length > 1 %}
      <ol class="page-hero__breadcrumbs">
        {# Skip the last item (current page) - it's the H1 #}
        {% for item in breadcrumb_items[:-1] %}
        <li>
          <a href="{{ item.href | absolute_url }}" class="page-hero__breadcrumb-link">{{ item.title }}</a>
        </li>
        {% endfor %}
      </ol>
      {% endif %}
    </nav>

    {# Actions: LLM Share Button #}
    <div class="page-hero__actions">
      {% set page_url = canonical_url(get_page_url(page)) %}
      {% set llm_txt_url = ensure_trailing_slash(page_url) ~ 'index.txt' %}
      {% set share_prompt = "Please help me understand this documentation: " + llm_txt_url %}

      <div class="page-hero__share">
        <button class="page-hero__share-trigger" popovertarget="page-hero-share-menu"
          aria-label="Share with AI assistants" title="Share with AI assistants">
          <span>á—¢</span>
          {{ icon('caret-down', size=14, css_class='page-hero__share-chevron') }}
        </button>

        <div id="page-hero-share-menu" popover class="page-hero__share-dropdown--popover">
          <div class="page-hero__share-content">
            {# Quick Actions #}
            <button class="page-hero__share-item" data-action="copy-url" data-url="{{ page_url }}" type="button">
              {{ icon('link', size=16) }}
              <span>Copy URL</span>
            </button>

            <a href="{{ llm_txt_url }}" target="_blank" rel="noopener noreferrer" class="page-hero__share-item">
              {{ icon('external', size=16) }}
              <span>Open LLM text</span>
            </a>

            <button class="page-hero__share-item" data-action="copy-llm-txt" data-url="{{ llm_txt_url }}" type="button">
              {{ icon('copy', size=16) }}
              <span>Copy LLM text</span>
            </button>

            <hr class="page-hero__share-separator">

            {# AI Assistant Links #}
            <div class="page-hero__share-section-header">Share with AI</div>

            <a href="https://claude.ai/new?q={{ share_prompt | urlencode }}" target="_blank" rel="noopener noreferrer"
              class="page-hero__share-item page-hero__share-ai" data-ai="claude">
              {{ icon('ai-claude', size=16) }}
              <span>Ask Claude</span>
            </a>

            <a href="https://chatgpt.com/?q={{ share_prompt | urlencode }}" target="_blank" rel="noopener noreferrer"
              class="page-hero__share-item page-hero__share-ai" data-ai="chatgpt">
              {{ icon('ai-chatgpt', size=16) }}
              <span>Ask ChatGPT</span>
            </a>

            <a href="https://gemini.google.com/app?q={{ share_prompt | urlencode }}" target="_blank" rel="noopener noreferrer"
              class="page-hero__share-item page-hero__share-ai" data-ai="gemini">
              {{ icon('ai-gemini', size=16) }}
              <span>Ask Gemini</span>
            </a>

            <a href="https://copilot.microsoft.com/?q={{ share_prompt | urlencode }}" target="_blank" rel="noopener noreferrer"
              class="page-hero__share-item page-hero__share-ai" data-ai="copilot">
              {{ icon('ai-copilot', size=16) }}
              <span>Ask Copilot</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Title - tight below breadcrumbs #}
  <h1 class="page-hero__title">{{ page.title }}</h1>

  {# Description #}
  {% if params.description %}
  <p class="page-hero__description">{{ params.description }}</p>
  {% endif %}

  {# Section Stats - page count instead of read time #}
  {% set page_count = posts | length if posts else 0 %}
  {% set subsection_count = subsections | length if subsections else 0 %}
  {% set total_count = page_count + subsection_count %}
  {% if total_count > 0 %}
  <div class="page-hero__meta page-hero__meta--section">
    <span class="page-hero__meta-item page-hero__meta-item--section">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
      </svg>
      <span>{{ total_count }} {{ 'page' if total_count == 1 else 'pages' }} in this section</span>
    </span>
  </div>
  {% endif %}
</div>
{% endif %}
