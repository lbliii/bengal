{#
  Article Card Component

  Displays a rich card preview of an article with metadata, tags, and optional image.

  Variables:
    - article: Page object to display (required)
    - show_excerpt: Boolean (default: true) - show description/excerpt
    - show_image: Boolean (default: false) - show featured image

  Features:
    - Responsive image with srcset (dogfoods image_srcset())
    - Dynamic badges for featured/tutorial/new tags
    - Reading time calculation
    - Relative time formatting (time_ago)
    - Accessible with semantic HTML

  Usage:
    {% include 'partials/article-card.html' with {'article': page} %}
    {% include 'partials/article-card.html' with {'article': post, 'show_image': true} %}
#}

{% set show_excerpt = show_excerpt | default(true) %}
{% set show_image = show_image | default(false) %}

<article class="article-card {% if article | has_tag('featured') %}featured-card{% endif %}">
    {% if show_image and article.metadata.image %}
    {# Responsive image with srcset - dogfooding image_srcset() #}
    <img
        src="{{ image_url(article.metadata.image, width=800) }}"
        srcset="{{ article.metadata.image | image_srcset([400, 800, 1200]) }}"
        sizes="(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px"
        alt="{{ article.metadata.image | image_alt }}"
        class="article-card-image"
        loading="lazy"
    >
    {% endif %}

    <div class="article-card-content">
        {# Tag badges - dogfooding has_tag() #}
        <div class="article-card-badges">
            {% if article | has_tag('featured') %}
            <span class="badge badge-featured">‚≠ê Featured</span>
            {% endif %}
            {% if article | has_tag('tutorial') %}
            <span class="badge badge-tutorial">üìö Tutorial</span>
            {% endif %}
            {% if article | has_tag('new') %}
            <span class="badge badge-new">‚ú® New</span>
            {% endif %}
        </div>

        <h2 class="article-card-title">
            <a href="{{ url_for(article) }}">{{ article.title }}</a>
        </h2>

        <div class="article-card-meta">
            {% if article.date %}
            <time datetime="{{ article.date | date_iso }}" title="{{ article.date | dateformat('%B %d, %Y') }}">
                {{ article.date | time_ago }}
            </time>
            {% endif %}

            {% if article.metadata.author %}
            <span class="author">{{ article.metadata.author }}</span>
            {% endif %}

            {% if article.content %}
            <span class="reading-time">
                {{ article.content | reading_time }} min read
            </span>
            {% endif %}
        </div>

        {% if show_excerpt %}
        <p class="article-card-excerpt">
            {% if article.metadata.description %}
                {{ article.metadata.description }}
            {% elif article.content %}
                {{ article.content | strip_html | excerpt(150) }}
            {% endif %}
        </p>
        {% endif %}

        {% if article.tags %}
        <div class="article-card-footer">
            {% set tags = article.tags %}
            {% set small = true %}
            {% include 'partials/tag-list.html' %}
        </div>
        {% endif %}
    </div>
</article>
