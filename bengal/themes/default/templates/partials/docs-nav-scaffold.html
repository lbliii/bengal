{#
Documentation Navigation Component (Scaffold Mode)

Progressive enhancement version of docs-nav that:
1. Renders static nav HTML once per scope and CACHES IT
2. Emits data attributes for active trail
3. JS applies active classes at runtime

This approach enables:
- Cached scaffold HTML per scope (section root + version)
- O(1) per-page cost (just data attributes + cached HTML lookup)
- Full tree available for expand/collapse

Variables:
- page: Current page object (required)
- show_nav_icons: Whether to show section icons (default: true)

Usage:
{% include 'partials/docs-nav-scaffold.html' %}
#}

{# Control icon visibility - defaults to true #}
{% set show_nav_icons = show_nav_icons if show_nav_icons is defined else true %}

{# Check if page is autodoc - autodoc pages should use scoped navigation #}
{% set is_autodoc = is_autodoc_page(page) if is_autodoc_page is defined else false %}

{# Scope docs navigation to the page's section root #}
{% set root_section = page._section.root if page._section else none %}

{# Get active trail for this page #}
{% set active_trail = get_active_trail(page) %}

{# Current page path for JS matching #}
{% set current_path = page._path if page._path is defined else '/' %}

{# Get CACHED scaffold HTML - renders once per scope, reuses on subsequent pages #}
{% set cached_html = get_cached_scaffold_html(page, root_section) %}

<nav class="docs-nav"
     aria-label="Documentation pages"
     data-bengal="docs-nav-scaffold"
     data-current-path="{{ current_path }}"
     data-active-trail="{{ active_trail | tojson }}">

  {# Version Selector - only show if page is versioned (not autodoc) #}
  {% if not is_autodoc %}
  {% include 'partials/version-selector.html' %}
  {% endif %}

  {# Navigation Tree - CACHED scaffold HTML #}
  <div class="docs-nav-tree">
    {{ cached_html | safe }}
  </div>
</nav>
