{#
Page Hero - API Reference Variant (DEPRECATED)

⚠️ DEPRECATION WARNING ⚠️
This template is deprecated and will be removed in a future release.
Use the new separated templates instead:
- partials/page-hero/element.html - For DocElement pages (modules, classes, commands)
- partials/page-hero/section.html - For section-index pages

Migration:
Replace: {% include 'partials/page-hero-api.html' %}
With: {% include 'partials/page-hero/element.html' %} (for element pages)
or: {% include 'partials/page-hero/section.html' %} (for section-index pages)

The dispatcher (partials/page-hero.html) already routes to the new templates when
hero_style == 'api' is used, so most consumers won't need to change.

---
Legacy documentation (for reference during migration):

Unified hero for API documentation pages that combines:
- Breadcrumbs + share dropdown (from editorial hero)
- Badges, qualified name, stats, source link (from module header)
- Vertical stacking for title + description

Designed for: module.html, class pages, function pages
#}

{% from 'partials/navigation-components.html' import breadcrumbs with context %}

{# Macro: Get page URL with fallback chain #}
{% macro get_page_url(page) -%}
{{ page.relative_url if page.relative_url is defined else (page.url if page.url is defined else '/') }}
{%- endmacro %}

{% if page %}
<div class="page-hero page-hero--api">
  {# Top row: Breadcrumbs (left) + Actions (right) #}
  <div class="page-hero__top">
    {# Breadcrumbs as eyebrow #}
    <nav class="page-hero__eyebrow" aria-label="Breadcrumb">
      {% set breadcrumb_items = get_breadcrumbs(page) %}
      {% if breadcrumb_items and breadcrumb_items | length > 1 %}
      <ol class="page-hero__breadcrumbs">
        {% for item in breadcrumb_items[:-1] %}
        <li>
          <a href="{{ item.url | absolute_url }}" class="page-hero__breadcrumb-link">{{ item.title }}</a>
        </li>
        {% endfor %}
      </ol>
      {% endif %}
    </nav>

    {# Share dropdown (uses icon system) #}
    {% include 'partials/page-hero/_share-dropdown.html' %}
  </div>

  {# Badge row - element type indicators (skip if element is None) #}
  {% if element %}
  <div class="page-hero__badges">
    {% include 'api-reference/partials/badges.html' %}
  </div>
  {% endif %}

  {# Title - qualified name for API, regular title otherwise #}
  {% if element and element.qualified_name %}
  <h1 class="page-hero__title page-hero__title--code">
    <code>{{ element.qualified_name }}</code>
  </h1>
  {% else %}
  <h1 class="page-hero__title">{{ page.title }}</h1>
  {% endif %}

  {# Description - markdown rendered, stacked vertically #}
  {# Priority: element.description > page.metadata.description > section.metadata.description #}
  {# Note: section.metadata is a dict, use .get() not attribute access #}
  {% set description = element.description if (element and element.description) else
  (page.metadata.get('description', '') if page.metadata.get('description', '') else
  (section.metadata.get('description', '') if section else '')) %}
  {% if description %}
  <div class="page-hero__description page-hero__description--prose">
    {{ description | markdownify | safe }}
  </div>
  {% endif %}

  {# Bottom row: Source link + Stats #}
  <div class="page-hero__footer">
    {# Source link (for elements with source files) #}
    {% if element and (element.display_source_file or element.source_file) and config is defined %}
    <a href="{{ config.github_repo }}/blob/{{ config.github_branch | default('main') }}/{{ element.display_source_file or element.source_file }}{% if element.line_number %}#L{{ element.line_number }}{% endif %}"
      class="page-hero__source-link" target="_blank" rel="noopener">
      {{ icon('file-code', size=14) }}
      <span>View source</span>
    </a>
    {% endif %}

    {# Element stats (uses get_element_stats filter) #}
    {% if element %}
    {% include 'partials/page-hero/_element-stats.html' %}
    {% endif %}

    {# Stats for section index pages (section-based) #}
    {% if section is defined and not element is defined %}
    {% set section_subsections = section.sorted_subsections | default([]) | list %}
    {% set section_pages = section.sorted_pages | default([]) | rejectattr('source_path', 'match', '.*_index.*') | list
    %}
    {# Detect if this is a CLI section based on URL path #}
    {% set is_cli_section = page.url is defined and '/cli' in page.url %}
    {% if section_subsections | length > 0 or section_pages | length > 0 %}
    <div class="page-hero__stats">
      {% if section_subsections | length > 0 %}
      <span class="page-hero__stat">
        <span class="page-hero__stat-value">{{ section_subsections | length }}</span>
        {% if is_cli_section %}
        <span class="page-hero__stat-label">{{ 'Group' if section_subsections | length == 1 else 'Groups' }}</span>
        {% else %}
        <span class="page-hero__stat-label">{{ 'Package' if section_subsections | length == 1 else 'Packages' }}</span>
        {% endif %}
      </span>
      {% endif %}
      {% if section_pages | length > 0 %}
      <span class="page-hero__stat">
        <span class="page-hero__stat-value">{{ section_pages | length }}</span>
        {% if is_cli_section %}
        <span class="page-hero__stat-label">{{ 'Command' if section_pages | length == 1 else 'Commands' }}</span>
        {% else %}
        <span class="page-hero__stat-label">{{ 'Module' if section_pages | length == 1 else 'Modules' }}</span>
        {% endif %}
      </span>
      {% endif %}
    </div>
    {% endif %}
    {% endif %}
  </div>
</div>
{% endif %}
