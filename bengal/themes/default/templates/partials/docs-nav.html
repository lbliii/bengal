{#
  Documentation Navigation Sidebar
  
  Displays hierarchical navigation tree for documentation sites.
  Shows all sections and pages with collapsible groups.
  
  Features:
  - Hierarchical structure
  - Active page highlighting
  - Active trail marking
  - Collapsible sections
  - Keyboard accessible
#}

<nav class="docs-nav" aria-label="Documentation pages"> 
  {# Navigation Tree #}
  <div class="docs-nav-tree">
    {# Determine the root section to display #}
    {# Strategy: If current page has a section, find its root ancestor #}
    {# This allows the nav to be scoped to just the docs tree, not the entire site #}
    {# Get the root section to display the navigation tree from the top #}
    {% set root_section = page._section.root if page._section else none %}
    
    {# If we have a root section, show only its tree #}
    {% if root_section %}
      {# Show the section's index page if it exists #}
      {% if root_section.index_page %}
        <a 
          href="{{ url_for(root_section.index_page) }}" 
          class="docs-nav-link {% if page.url == root_section.index_page.url %}active{% endif %}">
          Overview
        </a>
      {% endif %}
      
      {# Show regular pages in the root section #}
      {% for p in root_section.regular_pages %}
        <a 
          href="{{ url_for(p) }}" 
          class="docs-nav-link {% if page.url == p.url %}active{% endif %}">
          {{ p.title }}
        </a>
      {% endfor %}
      
      {# Show subsections #}
      {% for section in root_section.sections %}
        {% set depth = 0 %}
        {% include 'partials/docs-nav-section.html' %}
      {% endfor %}
    {% else %}
      {# Fallback: Show all top-level sections (original behavior) #}
      {% set top_sections = site.sections | selectattr('parent', 'none') | list %}
      
      {# Show any top-level pages first (regular pages without a section) #}
      {% set top_pages = site.pages | selectattr('_section', 'none') | rejectattr('metadata._generated', 'defined') | list %}
      {% for p in top_pages %}
        <a 
          href="{{ url_for(p) }}" 
          class="docs-nav-link {% if page.url == p.url %}active{% endif %}">
          {{ p.title }}
        </a>
      {% endfor %}
      
      {# Show all top-level sections #}
      {% for section in top_sections %}
        {% set depth = 0 %}
        {% include 'partials/docs-nav-section.html' %}
      {% endfor %}
    {% endif %}
  </div>
</nav>
