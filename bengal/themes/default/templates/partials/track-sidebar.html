{#
Track Sidebar Component

Left sidebar for track pages showing:
- Current track section navigation
- Other available tracks

Data Attributes (for JS):
- data-bengal="track-nav": Main navigation container
- data-track-id="slug": Track identifier for progress persistence
- data-track-section="N": Section link (N = section number)
- data-track-target="#id": Target section ID
- data-track-visited: Set by JS when section has been viewed
- data-track-completed: Set by JS when section scrolled past
- aria-current="step": Set by JS on active section

Usage:
{% include 'partials/track-sidebar.html' %}
#}

{% set track_id = params.track_id or page.slug %}
{% set current_track = site.data.tracks[track_id] if (track_id and site.data.tracks and track_id in site.data.tracks) else none %}

<nav class="track-sidebar" aria-label="Track navigation" data-bengal="track-nav" data-track-id="{{ track_id }}">
  {# Current Track Sections (Primary navigation) #}
  {% if current_track and current_track.items %}
  <section class="track-nav-sections">
    <h3 class="track-nav-title">{{ current_track.title or 'Sections' }}</h3>
    <ol class="track-nav-list">
      {% for item_slug in current_track.items %}
        {% set item_page = get_page(item_slug) %}
        {% if item_page %}
      <li>
        <a href="#track-section-{{ loop.index }}"
           class="track-nav-link"
           data-track-section="{{ loop.index }}"
           data-track-target="#track-section-{{ loop.index }}">
          <span class="track-nav-number">{{ loop.index }}</span>
          <span class="track-nav-label">{{ item_page.title }}</span>
        </a>
      </li>
        {% end %}
      {% end %}
    </ol>
  </section>
  {% end %}

  {# Other Tracks Section #}
  {% if site.data.tracks and site.data.tracks|length > 1 %}
  <section class="track-nav-other">
    <h3 class="track-nav-title">Other Tracks</h3>
    <ul class="track-nav-tracks">
      {% for id, track in site.data.tracks | items %}
        {% if id != track_id %}
        {% set track_pages = site.pages | where('metadata.track_id', id) %}
        {% set track_page = track_pages[0] if track_pages else None %}
        {% if track_page %}
      <li>
        <a href="{{ track_page.href }}" class="track-nav-track-link">
          <span class="track-nav-track-title">{{ track.title }}</span>
          <span class="track-nav-track-meta">{{ track.items|length }} lessons</span>
        </a>
      </li>
        {% end %}
        {% end %}
      {% end %}
    </ul>
  </section>
  {% end %}
</nav>
