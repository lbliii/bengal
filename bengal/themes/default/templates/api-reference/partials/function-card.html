{#
Function Card Macro

Renders a function as an information-rich collapsible card.
Shows: icon, name, param count, return type, description preview.
Uses unified api-card classes from autodoc CSS modules.
#}

{% macro function_card(func) %}
{# Use normalized param_count and return_type filters #}
{% set func_param_count = func | param_count %}
{% set func_return_type = func | return_type %}
{% set is_async = func.metadata.is_async | default(false) %}
{% set first_sentence = ((func.description or '') | truncate(100, True, '…')) %}

<details class="api-card api-card--collapsible api-card--function{% if is_async %} api-card--async{% endif %}{% if func.name.startswith('_') %} api-card--private{% endif %}">
  <summary class="api-card__header">
    {# Icon #}
    <span class="api-card__icon">
      {% if is_async %}
      {{ icon('lightning', size=18) }}
      {% else %}
      {{ icon('function', size=18) }}
      {% endif %}
    </span>

    {# Name + description preview #}
    <div class="api-card__info">
      <div class="api-card__name-row">
        <code class="api-card__name">{{ func.name }}</code>
        {% if is_async %}<span class="api-badge--inline api-badge--async">async</span>{% endif %}
      </div>
      {% if first_sentence %}
      <span class="api-card__desc-preview">{{ first_sentence }}</span>
      {% endif %}
    </div>

    {# Meta: params + return #}
    <div class="api-card__meta">
      <span class="api-card__params" title="{{ func_param_count }} parameter{% if func_param_count != 1 %}s{% endif %}">
        {{ icon('brackets-curly', size=12) }}
        <span>{{ func_param_count }}</span>
      </span>
      <span class="api-card__return" title="Returns {{ func_return_type }}">
        {{ icon('arrow-right', size=12) }}
        <code>{{ func_return_type | truncate(20, True, '…') }}</code>
      </span>
    </div>

    {# Toggle #}
    <span class="api-card__toggle">
      {{ icon('caret-right', size=14) }}
    </span>
  </summary>

  <div class="api-card__body">
    {# Full signature #}
    {% set element = func %}
    {% include 'api-reference/partials/signature.html' %}

    {# Full description (markdown rendered) #}
    {% if func.description %}
    <div class="api-card__description">{{ func.description | markdownify | safe }}</div>
    {% endif %}

    {# Parameters, Returns, Raises #}
    {% set element = func %}
    {% include 'api-reference/partials/parameters-table.html' %}
    {% set element = func %}
    {% include 'api-reference/partials/returns-section.html' %}
    {% set element = func %}
    {% include 'api-reference/partials/raises-list.html' %}

    {# Examples #}
    {% if func.metadata.examples %}
    <div class="api-examples">
      <h4 class="api-label">Examples</h4>
      {% for example in func.metadata.examples %}
      <div class="code-block-wrapper">
        <div class="code-header-inline">
          <span class="code-language">Python</span>
        </div>
        <pre><code class="language-python">{{ example }}</code></pre>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</details>
{% endmacro %}
