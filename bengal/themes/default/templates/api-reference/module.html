{% extends "base.html" %}

{#
API Reference Module Template

Renders a Python module's API documentation using the unified autodoc skeleton.
Extends base.html to inherit theme navigation, sidebars, and styling.
Uses autodoc.css for all styling.

This template receives:
- element: DocElement for the module
- config: Autodoc configuration
- site: Site instance
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation, toc with context %}

{% block content %}
{# Pre-compute element children - use getattr for safe access #}
{% set element_children = getattr(element, 'children', []) %}
{% set classes = element_children | selectattr('element_type', 'eq', 'class') | list %}
{% set functions = element_children | selectattr('element_type', 'eq', 'function') | list %}

{# Three-column documentation layout #}
<div class="docs-layout">
  {# Left Sidebar: Navigation #}
  <aside class="docs-sidebar" id="docs-sidebar" role="navigation" aria-label="API navigation">
    {% include 'partials/docs-nav.html' %}
  </aside>

  {# Main Content #}
  <div class="docs-main">
    {# Page Hero: Breadcrumbs + Badges + Title + Description + Stats #}
    {% include 'partials/page-hero/element.html' %}

    {# Article Content - New autodoc skeleton #}
    <article data-autodoc data-type="python" data-element="module" class="autodoc docs-content">

      {# Classes Section #}
      {% if classes %}
      <section class="autodoc-section" data-section="classes">
        <h2 class="autodoc-section-title">Classes</h2>
        <div class="autodoc-cards">
          {% for cls in classes %}
          {% set cls_url = cls.url | default('/api/' ~ (cls.qualified_name | replace('.', '/')) ~ '/') %}
          <a href="{{ cls_url }}" class="autodoc-card" data-card="class">
            <code class="autodoc-card-name">{{ cls.name }}</code>
            {% if cls.description %}
            <span class="autodoc-card-desc">{{ cls.description | truncate(100) }}</span>
            {% endif %}
            {% if cls.metadata.is_dataclass %}
            <span class="autodoc-badge" data-badge="dataclass">dataclass</span>
            {% endif %}
            {% if cls.metadata.is_abstract %}
            <span class="autodoc-badge" data-badge="abstract">abstract</span>
            {% endif %}
          </a>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      {# Functions Section #}
      {% if functions %}
      <section class="autodoc-section" data-section="functions">
        <h2 class="autodoc-section-title">Functions</h2>
        <div class="autodoc-cards">
          {% for func in functions %}
          {% set func_url = func.url | default('/api/' ~ (func.qualified_name | replace('.', '/')) ~ '/') %}
          <a href="{{ func_url }}" class="autodoc-card" data-card="function">
            <code class="autodoc-card-name">{{ func.name }}</code>
            {% if func.description %}
            <span class="autodoc-card-desc">{{ func.description | truncate(100) }}</span>
            {% endif %}
            {% if func.metadata.is_async %}
            <span class="autodoc-badge" data-badge="async">async</span>
            {% endif %}
          </a>
          {% endfor %}
        </div>
      </section>
      {% endif %}

      {# Tags #}
      {% if page.tags %}
      <footer class="docs-footer">
        <span class="docs-footer-label">Tagged</span>
        {% from 'partials/content-components.html' import tag_list with context %}
        {{ tag_list(page.tags) }}
      </footer>
      {% endif %}
    </article>

    {# Page navigation (prev/next) at bottom #}
    {{ page_navigation(page) }}
  </div>

  {# Right Sidebar: Contextual Graph + TOC + Metadata #}
  {% include 'partials/docs-toc-sidebar.html' %}
</div>

{# Mobile sidebar toggle button #}
<button class="docs-sidebar-toggle" aria-label="Toggle navigation sidebar" aria-expanded="false"
  aria-controls="docs-sidebar">
  {{ icon('list', size=20) }}
</button>

{# Sidebar overlay for mobile #}
<div class="docs-sidebar-overlay" aria-hidden="true"></div>
{% endblock %}
