{% extends "base.html" %}

{#
API Reference Section Index Template

Renders an API section index page showing subsections and modules
using a card-based layout. Extends base.html to inherit theme navigation.

This template receives:
- section: Section object for the API section
- config: Autodoc configuration
- site: Site instance
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation, toc with context %}

{% block content %}
{# Three-column documentation layout #}
<div class="docs-layout">
  {# Left Sidebar: Navigation #}
  <aside class="docs-sidebar" id="docs-sidebar" role="navigation" aria-label="API navigation">
    {% include 'partials/docs-nav.html' %}
  </aside>

  {# Main Content #}
  <div class="docs-main">
    {# Page Hero: Breadcrumbs + Title + Description #}
    {% include 'partials/page-hero.html' %}

    {# Article Content #}
    <article class="prose {% if page.metadata.get('css_class') %}{{ page.metadata.get('css_class') }}{% endif %}">
      <div class="docs-content">
        {# API Explorer Section Index Content #}
        <div class="api-explorer api-explorer--index">
          <header class="api-section-header">
            <h1 class="api-section-header__title">{{ section.title }}</h1>
            {% if section.metadata.description %}
            <p class="api-section-header__description">{{ section.metadata.description | first_sentence }}</p>
            {% else %}
            <p class="api-section-header__description">Browse {{ section.name }} packages and modules.</p>
            {% endif %}
          </header>

          {# Quick Stats Bar #}
          <div class="api-stats">
            {% if section.subsections %}
            <span class="api-stat">
              <span class="api-stat__count">{{ section.subsections | length }}</span>
              <span class="api-stat__label">Packages</span>
            </span>
            {% endif %}
            {% set module_pages = section.sorted_pages | selectattr('metadata.element_type', 'defined') | list %}
            {% if module_pages %}
            <span class="api-stat">
              <span class="api-stat__count">{{ module_pages | length }}</span>
              <span class="api-stat__label">Modules</span>
            </span>
            {% endif %}
          </div>

          {# Subsections (Packages) - Card Grid #}
          {% if section.sorted_subsections %}
          <section class="api-section api-section--packages">
            <h2 class="api-section__title">Packages</h2>

            <div class="api-grid api-grid--packages">
              {% for subsection in section.sorted_subsections %}
              {% if subsection.name %}
              {% set desc = subsection.metadata.description | default('') | first_sentence %}
              {% set child_count = (subsection.subsections | length) + (subsection.pages | length) %}
              <a href="{{ subsection.relative_url }}" class="api-package-card">
                <div class="api-package-card__header">
                  <span class="api-package-card__icon">{{ icon("folder", size=20, css_class="icon-muted") }}</span>
                  <span class="api-package-card__name">{{ subsection.name | title }}</span>
                </div>
                <div class="api-package-card__body">
                  {% if desc %}
                  <p class="api-package-card__description">{{ desc }}</p>
                  {% else %}
                  <p class="api-package-card__description api-package-card__description--empty">{{ subsection.name | title }} package</p>
                  {% endif %}
                </div>
                <div class="api-package-card__footer">
                  <span class="api-package-card__meta">
                    {{ child_count }} item{{ 's' if child_count != 1 else '' }}
                  </span>
                </div>
              </a>
              {% endif %}
              {% endfor %}
            </div>
          </section>
          {% endif %}

          {# Module Pages - Card Grid #}
          {% set module_pages = [] %}
          {% for page in section.sorted_pages %}
            {% if page != section.index_page and not (page.source_path is match('.*_index.*')) %}
              {% set _ = module_pages.append(page) %}
            {% endif %}
          {% endfor %}

          {% if module_pages %}
          <section class="api-section api-section--modules">
            <h2 class="api-section__title">Modules</h2>

            <div class="api-grid api-grid--modules">
              {% for page in module_pages %}
              {% set desc = page.metadata.description | default('') | first_sentence %}
              <a href="{{ page.relative_url }}" class="api-module-card">
                <div class="api-module-card__header">
                  <span class="api-module-card__icon">
                    {%- if page.metadata.element_type == 'class' -%}
                    {{ icon("layers", size=16, css_class="icon-info") }}
                    {%- elif page.metadata.element_type == 'function' -%}
                    {{ icon("zap", size=16, css_class="icon-success") }}
                    {%- else -%}
                    {{ icon("code", size=16, css_class="icon-muted") }}
                    {%- endif -%}
                  </span>
                  <span class="api-module-card__name">{{ page.title }}</span>
                  {% if page.metadata.element_type %}
                  <span class="api-badge--mini api-badge--{{ page.metadata.element_type }}">{{ page.metadata.element_type }}</span>
                  {% endif %}
                </div>
                <div class="api-module-card__body">
                  {% if desc %}
                  <p class="api-module-card__description">{{ desc }}</p>
                  {% else %}
                  <p class="api-module-card__description api-module-card__description--empty">No description available</p>
                  {% endif %}
                </div>
              </a>
              {% endfor %}
            </div>
          </section>
          {% endif %}

          {# Empty State #}
          {% if not section.subsections and not module_pages %}
          <div class="api-empty-state">
            <div class="api-empty-state__icon">{{ icon("file-text", size=48, css_class="icon-muted") }}</div>
            <p class="api-empty-state__text">No documentation available in this section yet.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </article>

    {# Page navigation (prev/next) at bottom #}
    {{ page_navigation(page) }}
  </div>

  {# Right Sidebar: Contextual Graph + TOC + Metadata #}
  {% include 'partials/docs-toc-sidebar.html' %}
</div>

{# Mobile sidebar toggle button #}
<button class="docs-sidebar-toggle" aria-label="Toggle navigation sidebar" aria-expanded="false"
  aria-controls="docs-sidebar">
  {{ icon('list', size=20) }}
</button>

{# Sidebar overlay for mobile #}
<div class="docs-sidebar-overlay" aria-hidden="true"></div>
{% endblock %}
