{% extends "base.html" %}

{#
API Reference Section Index Template

Renders an API section index page showing subsections and modules
using a card-based layout. Extends base.html to inherit theme navigation.

This template receives:
- section: Section object for the API section
- config: Autodoc configuration
- site: Site instance
#}

{% from 'partials/navigation-components.html' import breadcrumbs, page_navigation, toc with context %}

{% block content %}
{# Three-column documentation layout #}
<div class="docs-layout">
  {# Left Sidebar: Navigation #}
  <aside class="docs-sidebar" id="docs-sidebar" role="navigation" aria-label="API navigation">
    {% include 'partials/docs-nav.html' %}
  </aside>

  {# Main Content #}
  <div class="docs-main">
    {# Unified API Page Hero: Breadcrumbs + Badges + Title + Description + Stats #}
    {% include 'partials/page-hero-api.html' %}

    {# Article Content #}
    <article class="prose {% if page.metadata.get('css_class') %}{{ page.metadata.get('css_class') }}{% endif %}">
      {# Build module list once for counts + cards #}
      {% set module_pages = [] %}
      {% for page in section.sorted_pages %}
        {% if page != section.index_page and not (page.source_path is match('.*_index.*')) %}
          {% set _ = module_pages.append(page) %}
        {% endif %}
      {% endfor %}

      {# Overview card: description + quick stats #}
      <div class="api-section-overview">
        {% set section_desc = section.metadata.description | default('') %}
        {% if section_desc %}
        <p class="api-section-overview__description">{{ section_desc | first_sentence }}</p>
        {% else %}
        <p class="api-section-overview__description">Browse {{ section.name }} packages and modules.</p>
        {% endif %}

        <div class="api-section-overview__stats">
          {% if section.sorted_subsections %}
          <span class="api-pill">
            {{ icon("folder", size=14, css_class="icon-muted") }}
            <span class="api-pill__label">{{ section.sorted_subsections | length }} package{{ 's' if section.sorted_subsections | length != 1 else '' }}</span>
          </span>
          {% endif %}
          {% if module_pages %}
          <span class="api-pill">
            {{ icon("code", size=14, css_class="icon-muted") }}
            <span class="api-pill__label">{{ module_pages | length }} module{{ 's' if module_pages | length != 1 else '' }}</span>
          </span>
          {% endif %}
        </div>
      </div>

      <div class="docs-content">
        {# API Explorer Section Index Content #}
        <div class="api-explorer api-explorer--index">
          {# Subsections (Packages) - Card Grid #}
          {% if section.sorted_subsections %}
          <section class="api-section api-section--packages">
            <h2 class="api-section__title">Packages</h2>

            <div class="api-grid api-grid--packages">
              {% for subsection in section.sorted_subsections %}
              {% if subsection.name %}
              {% set desc = subsection.metadata.description | default('') | first_sentence %}
              {% set child_count = (subsection.subsections | length) + (subsection.pages | length) %}
              <a href="{{ subsection.url }}" class="api-package-card">
                <div class="api-package-card__header">
                  <span class="api-package-card__icon">{{ icon("folder", size=20, css_class="icon-muted") }}</span>
                  <span class="api-package-card__name">{{ subsection.name | title }}</span>
                </div>
                <div class="api-package-card__body">
                  {% if desc %}
                  <p class="api-package-card__description">{{ desc }}</p>
                  {% else %}
                  <p class="api-package-card__description api-package-card__description--empty">{{ subsection.name | title }} package</p>
                  {% endif %}
                </div>
                <div class="api-package-card__footer">
                  <span class="api-package-card__meta">
                    {{ child_count }} item{{ 's' if child_count != 1 else '' }}
                  </span>
                </div>
              </a>
              {% endif %}
              {% endfor %}
            </div>
          </section>
          {% endif %}

          {# Module Pages - Card Grid #}
          {% if module_pages %}
          <section class="api-section api-section--modules">
            <h2 class="api-section__title">Modules</h2>

            <div class="api-grid api-grid--modules">
              {% for page in module_pages %}
              {% set desc = page.metadata.description | default('') | first_sentence %}
              <a href="{{ page.url }}" class="api-module-card">
                <div class="api-module-card__header">
                  <span class="api-module-card__icon">
                    {%- if page.metadata.element_type == 'class' -%}
                    {{ icon("layers", size=16, css_class="icon-info") }}
                    {%- elif page.metadata.element_type == 'function' -%}
                    {{ icon("zap", size=16, css_class="icon-success") }}
                    {%- else -%}
                    {{ icon("code", size=16, css_class="icon-muted") }}
                    {%- endif -%}
                  </span>
                  <span class="api-module-card__name">{{ page.title }}</span>
                  {% if page.metadata.element_type %}
                  <span class="api-badge--mini api-badge--{{ page.metadata.element_type }}">{{ page.metadata.element_type }}</span>
                  {% endif %}
                </div>
                <div class="api-module-card__body">
                  {% if desc %}
                  <p class="api-module-card__description">{{ desc }}</p>
                  {% else %}
                  <p class="api-module-card__description api-module-card__description--empty">No description available</p>
                  {% endif %}
                </div>
              </a>
              {% endfor %}
            </div>
          </section>
          {% endif %}

          {# Empty State #}
          {% if not section.subsections and not module_pages %}
          <div class="api-empty-state">
            <div class="api-empty-state__icon">{{ icon("file-text", size=48, css_class="icon-muted") }}</div>
            <p class="api-empty-state__text">No documentation available in this section yet.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </article>

    {# Page navigation (prev/next) at bottom #}
    {{ page_navigation(page) }}
  </div>

  {# Right Sidebar: Contextual Graph + TOC + Metadata #}
  {% include 'partials/docs-toc-sidebar.html' %}
</div>

{# Mobile sidebar toggle button #}
<button class="docs-sidebar-toggle" aria-label="Toggle navigation sidebar" aria-expanded="false"
  aria-controls="docs-sidebar">
  {{ icon('list', size=20) }}
</button>

{# Sidebar overlay for mobile #}
<div class="docs-sidebar-overlay" aria-hidden="true"></div>
{% endblock %}
