{% extends "base.html" %}

{% block content %}
{% include 'partials/breadcrumbs.html' %}

{# Section navigation for section pages - dogfooding section properties #}
{% if section %}
    {% set page = section %}
    {% include 'partials/section-navigation.html' %}
{% endif %}

<div class="archive">
    <header class="archive-header">
        <h1>{{ title | default(section.title if section else 'Archive') }}</h1>
        
        {% if description %}
        <p class="archive-description">{{ description }}</p>
        {% endif %}
        
        {% if total_pages %}
        <p class="archive-count">
            Showing {{ posts | length }} of {{ total_posts }} posts
            {% if current_page > 1 %}(Page {{ current_page }} of {{ total_pages }}){% endif %}
        </p>
        {% endif %}
    </header>
    
    {% if posts %}
    {# Show featured posts first - dogfooding where() and where_not() #}
    {% set featured_posts = posts | where('featured', true) %}
    {% if featured_posts %}
    <section class="featured-posts">
        <h2 class="section-subtitle">Featured Posts</h2>
        <div class="archive-list archive-list-featured">
            {% for post in featured_posts %}
                {% set article = post %}
                {% set show_excerpt = true %}
                {% set show_image = true %}
                {% include 'partials/article-card.html' %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    {# Regular posts - dogfooding where_not() #}
    {% set regular_posts = posts | where_not('featured', true) %}
    {% if regular_posts %}
    <section class="regular-posts">
        {% if featured_posts %}<h2 class="section-subtitle">All Posts</h2>{% endif %}
        <div class="archive-list">
            {% for post in regular_posts %}
                {% set article = post %}
                {% set show_excerpt = true %}
                {% include 'partials/article-card.html' %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    {# Pagination #}
    {% if total_pages and total_pages > 1 %}
    {% include 'partials/pagination.html' %}
    {% endif %}
    {% elif subsections %}
    {# Show subsections if no direct posts #}
    <section class="subsections">
        <h2 class="section-subtitle">Sections</h2>
        <div class="archive-list">
            {% for subsection in subsections %}
            <article class="archive-item">
                <h3><a href="{{ subsection.url }}">{{ subsection.title }}</a></h3>
                {% if subsection.metadata.description %}
                <p>{{ subsection.metadata.description }}</p>
                {% endif %}
                {% if subsection.pages %}
                <p class="meta">{{ subsection.pages | length }} page(s)</p>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <div class="archive-empty">
        <p>No content in this section yet.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

