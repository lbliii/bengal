{#- Hugo-style reusable "partials" as Jinja2 macros -#}

{#- Section wrapper macro (like Hugo partials) -#}
{% macro render_section(section_name) %}
{% if caller %}
<div class="autodoc-section" data-section="{{ section_name }}">
{{ caller() }}
</div>
{% endif %}
{% endmacro %}

{#- Class rendering macro with error handling -#}
{% macro render_class(cls) %}
{% if cls %}
### `{{ cls.name }}`

{% if cls.description %}
{{ cls.description }}
{% else %}
*No class description provided.*
{% endif %}

{#- Recursively render methods -#}
{% if cls.children | selectattr('element_type', 'equalto', 'method') | list %}
#### Methods
{% for method in cls.children | selectattr('element_type', 'equalto', 'method') %}
{{ render_method(method) }}
{% endfor %}
{% endif %}

{% endif %}
{% endmacro %}

{#- Method rendering with safe parameter handling -#}
{% macro render_method(method) %}
{% if method %}
##### `{{ method.name }}`

```python
{{ method.metadata.signature | default(method.name + "()") }}
```

{% if method.description %}
{{ method.description }}
{% endif %}

{#- Safe parameter rendering -#}
{% set params = method.metadata.args | default([]) %}
{% if params %}
{{ render_parameter_table(params, "Parameters") }}
{% endif %}

{% endif %}
{% endmacro %}

{#- Reusable parameter table (like Hugo partial) -#}
{% macro render_parameter_table(parameters, title="Parameters") %}
{% if parameters %}
**{{ title }}:**

| Name | Type | Default | Description |
|------|------|---------|-------------|
{% for param in parameters %}
| `{{ param.name }}` | {{ param.annotation | code_or_dash }} | {{ param.default | code_or_dash }} | {{ param.docstring | default("-") }} |
{% endfor %}

{% endif %}
{% endmacro %}
