---
title: Bengal 0.1.6
description: AST-based content pipeline, parse-once-use-many architecture, and type-safe content transformations
type: changelog
date: 2025-12-22
draft: false
lang: en
tags: [release, changelog, ast, performance, architecture]
keywords: [release, 0.1.6, ast, content-pipeline, performance, type-safety]
category: changelog
---

# Bengal 0.1.6

**Key additions:** AST-based content pipeline for parse-once-use-many semantics, type-safe link transformations, and faster content extraction.

---

## Highlights

### AST-Based Content Pipeline

Bengal now parses Markdown to an Abstract Syntax Tree (AST) first, then derives all outputs from that single parse. This replaces the previous HTML-centric model where content was re-parsed for each operation.

**Benefits:**

- **Parse Once**: Single Markdown parse produces AST; TOC, links, and plain text all derive from it
- **Type Safety**: AST operations use typed `ASTNode` unions instead of regex on HTML
- **Performance**: AST walks have better constant factors than regex scans

```python
# New: Direct AST access for plugins
for node in walk_ast(page.ast):
    if node.get("type") == "heading":
        print(f"H{node['level']}: {extract_text(node)}")
```

### Content Representation Properties

Pages now expose multiple content representations:

| Property | Type | Purpose |
|----------|------|---------|
| `page.content` | `str` | Raw Markdown source |
| `page.ast` | `list[ASTNode]` | Parsed Abstract Syntax Tree |
| `page.html` | `str` | Rendered HTML (from AST) |
| `page.plain_text` | `str` | Plain text for search indexing |

### AST Utilities

New utility functions for working with AST:

```python
from bengal.rendering.ast_utils import (
    walk_ast,           # Depth-first traversal
    extract_toc_from_ast,    # TOC extraction
    extract_links_from_ast,  # Link extraction
    extract_plain_text,      # Search indexing
)

from bengal.rendering.ast_transforms import (
    transform_links_in_ast,   # Generic link transformation
    normalize_md_links_in_ast, # .md â†’ clean URLs
    add_baseurl_to_ast,       # Prepend baseurl
)
```

### RawHTMLNode for Directives

Directive output and pre-rendered content now use `RawHTMLNode` in the AST:

```python
from bengal.rendering.ast_types import RawHTMLNode, is_raw_html

# Directive output appears as raw_html nodes
node: RawHTMLNode = {"type": "raw_html", "content": "<div class='note'>...</div>"}
```

---

## Performance

| Operation | Before | After | Improvement |
|-----------|--------|-------|-------------|
| TOC extraction | HTMLParser + regex | AST walk | ~1.5x faster |
| Link transformation | Regex on HTML | AST map | ~2x faster |
| Plain text extraction | Regex strip tags | AST walk | ~1.5x faster |

Both approaches are O(n), but AST walks have better constant factors: no regex compilation, no string allocation from `re.sub`, and cache-friendly sequential access.

---

## For Plugin Authors

Direct AST access is now available for advanced use cases:

```python
# Access AST after parsing
ast = page.ast  # list[ASTNode]

# Walk all nodes
for node in walk_ast(ast):
    if is_link(node):
        print(f"Link: {node['url']}")
    elif is_heading(node):
        print(f"Heading: {extract_text(node)}")

# Transform links
transformed = transform_links_in_ast(ast, lambda url: f"/prefix{url}")
```

---

## Breaking Changes

None. The `page.html` property continues to work as before, now rendering from AST when available with fallback to legacy behavior.

---

## Technical Details

- **68 new tests**: 29 unit tests for AST utilities, 29 for transforms, 10 integration tests
- **Type guards**: `is_link()`, `is_image()`, `is_raw_html()` for type-safe AST operations
- **Thread safety**: AST extraction is safe for parallel builds
- **Documentation**: Content Processing API updated with new properties

---

## Full Changelog

See the [complete changelog](https://github.com/yourusername/bengal/blob/main/changelog.md) for all changes.
