---
title: Bengal 0.1.9
description: Build performance, incremental observability, header customization, protocol layer, and structured error handling
type: changelog
date: 2026-01-23
draft: true
lang: en
tags: [release, changelog, performance, cache, errors, incremental, themes, protocols]
keywords: [release, 0.1.9, fast mode, autodoc caching, cache coordinator, error handling, serve-first, header, protocols]
category: changelog
---

# Bengal 0.1.9

**Key additions:** Build performance optimizations (~50-60% faster), incremental build observability (`--explain`/`--dry-run`), configurable header navigation, protocol layer architecture, smart changelog sorting, structured error handling, and serve-first dev server startup.

---

## Highlights

### Build Performance Optimizations

Three-phase performance RFC delivering cumulative ~50-60% speedup for large sites:

- **Fast mode** (`build.fast_mode=True`): Skip HTML pretty-printing/minification for ~10-15% speedup
- **Render-time asset tracking**: ContextVar-based AssetTracker eliminates post-render HTML parsing (~20-25% speedup)
- **Autodoc AST caching**: Cache parsed Python module data across builds (~30-40% speedup for autodoc-heavy sites)
- **Parser pooling**: Re-enabled with patitas 0.1.1's `_reinit()` support (~78% faster parser instantiation)

### Incremental Build Observability

New CLI flags for understanding rebuild decisions:

```bash
# Explain why pages are being rebuilt
bengal build --explain

# Preview what would be rebuilt without doing it
bengal build --dry-run

# Machine-readable rebuild manifest
bengal build --explain-json > manifest.json
```

### Cache Coordination

Unified `CacheCoordinator` manages cache invalidation across all subsystems:

- **PathRegistry**: Centralized path-to-cache-key mapping
- **RebuildManifest**: Tracks what needs rebuilding and why
- **Content-hash embedding**: O(1) change detection via embedded hashes in output
- **GeneratedPageCache**: Deduplicates taxonomy/archive page generation

### Structured Error Handling

Five new exception classes with actionable suggestions:

| Exception | Use Case |
|-----------|----------|
| `BengalParsingError` | Markdown/frontmatter parsing failures |
| `BengalAutodocError` | Autodoc extraction issues |
| `BengalValidatorError` | Health check validation failures |
| `BengalBuildError` | Build pipeline errors |
| `BengalTemplateFunctionError` | Template filter/function errors |

All exceptions include error codes (O/V/B series) and contextual suggestions.

### Serve-First Startup

Dev server now serves cached content immediately when cache exists:

```bash
bengal serve  # First paint in ~200ms instead of ~2-3s
```

The build runs in the background while serving stale content, then hot-reloads when ready.

### Header Customization

New theme configuration options for header navigation:

```yaml
# In theme.yaml or site config
theme:
  header:
    nav_position: center  # left | center
    sticky: true          # fixed header on scroll
    autohide: true        # hide on scroll down, show on scroll up
```

CSS variants applied via `data-nav-position`, `data-sticky`, `data-autohide` attributes.

### Protocol Layer Architecture

New `bengal.protocols` module centralizes shared interfaces:

- `Cacheable` — serialization contract for cache-storable objects
- `ProgressReporter` — build progress reporting interface
- `HighlightService` — syntax highlighting abstraction

Reduces coupling between subsystems and improves testability.

### Smart Changelog Sorting

The `releases` filter now supports semantic version sorting:

```jinja
{% for release in releases() %}
  {{ release.title }}  {# Sorted by semver, not string #}
{% endfor %}
```

Also: domain-aware filtering, simplified API (always sorts by default).

### External Patitas Migration

The embedded Markdown parser has been extracted to the standalone `patitas` package:

- ~15k lines removed from Bengal core
- Parser maintained as separate PyPI package
- ContextVar configuration pattern for thread-safe parsing
- ParserPool/RendererPool for high-throughput scenarios

---

## Breaking Changes

None. This is a fully backward-compatible release.

---

## Bug Fixes

- **Duplicate tag pages**: Fixed incremental builds generating duplicate taxonomy pages
- **Anchor fragment preservation**: `.md` links now preserve `#section` anchors during normalization
- **Serve-first activation**: Fixed serve-first not triggering when `baseurl` is `/`
- **Python 3.14 import scoping**: Fixed cache loading issue with import scoping in 3.14
- **Section-level optimization**: Fixed subsection change detection in incremental builds
- **Warm CI builds**: Detect missing autodoc output and special pages (graph, search) on cache restore

---

## Dependency Updates

| Package | Version | Change |
|---------|---------|--------|
| `patitas` | ≥0.1.1 | Adds `_reinit()` for parser pooling |
| `kida-templates` | ≥0.1.2 | RenderContext, profiling support |

---

## Upgrading

```bash
uv pip install --upgrade bengal
# or
pip install --upgrade bengal
# or use the new self-update command
bengal upgrade
```
